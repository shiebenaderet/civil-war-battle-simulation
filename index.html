<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Civil War Battle Simulation - Educational Edition</title>
    
    <!-- Kagi Translation Integration -->
    <script type="text/javascript">
        function translateWithKagi(targetLanguage) {
            // Get the current domain/hostname
            const currentDomain = window.location.hostname;
            const currentPort = window.location.port ? `:${window.location.port}` : '';
            const fullDomain = `${currentDomain}${currentPort}`;
            
            // Create Kagi translate URL with embedded format
            const kagiUrl = `https://translate.kagi.com/${fullDomain}${window.location.pathname}${window.location.search}`;
            
            // Navigate to the translated version in the same tab
            window.location.href = kagiUrl;
        }
        
        // Vocabulary Sidebar Toggle
        function toggleVocabSidebar() {
            const sidebar = document.getElementById('vocabSidebar');
            sidebar.classList.toggle('open');
        }
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            background-color: #2a2a2a;
            color: #f0f0f0;
            min-height: 100vh;
            background-image: 
                linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)),
                repeating-linear-gradient(45deg, transparent, transparent 10px, rgba(255,255,255,.03) 10px, rgba(255,255,255,.03) 20px);
        }

        .game-container {
            width: 100%;
            max-width: 1000px;
            padding: 20px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            align-items: flex-start;
            padding-top: 40px;
        }

        /* Language and Accessibility Controls */
        /* Vocabulary Sidebar */
        .vocab-sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 280px;
            height: 100vh;
            background: rgba(0,0,0,0.95);
            border-right: 2px solid #444;
            padding: 20px;
            z-index: 1200;
            overflow-y: auto;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }
        
        .vocab-sidebar.open {
            transform: translateX(0);
        }
        
        .vocab-sidebar h3 {
            color: #ffd700;
            margin-bottom: 20px;
            font-size: 1.2em;
            text-align: center;
            border-bottom: 2px solid #ffd700;
            padding-bottom: 10px;
        }
        
        .vocab-list {
            list-style: none;
        }
        
        .vocab-item {
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            border-left: 3px solid #ffd700;
        }
        
        .vocab-term-name {
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 5px;
        }
        
        .vocab-definition-text {
            color: #f0f0f0;
            font-size: 0.9em;
            line-height: 1.4;
        }
        
        .vocab-toggle-btn {
            position: fixed;
            left: 20px;
            top: 20px;
            background: linear-gradient(135deg, #ffd700, #f59e0b);
            color: #000;
            border: none;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Georgia', serif;
            font-weight: bold;
            z-index: 1300;
            box-shadow: 0 4px 15px rgba(255,215,0,0.3);
            transition: all 0.3s ease;
        }
        
        .vocab-toggle-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(255,215,0,0.4);
        }

        .controls-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.9);
            border: 1px solid #444;
            border-radius: 10px;
            padding: 12px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 8px;
            align-items: center;
            max-width: 200px;
        }

        /* Kagi Translation widget styling */
        .translate-select {
            background: rgba(255,255,255,0.1);
            border: 1px solid #666;
            color: #fff;
            padding: 5px 10px;
            border-radius: 5px;
            font-family: 'Georgia', serif;
            font-size: 0.9em;
        }
        
        .translate-select option {
            background: #2a2a2a;
            color: #fff;
        }

        .vocab-toggle {
            background: linear-gradient(135deg, #059669, #10b981);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Georgia', serif;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .vocab-toggle:hover {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .vocab-toggle.active {
            background: linear-gradient(135deg, #ffd700, #f59e0b);
            color: #000;
        }

        /* Screen Display Management */
        .side-selection {
            display: block;
            text-align: center;
            animation: fadeIn 1s ease-out;
            width: 100%;
        }

        .side-introduction,
        .game-screen,
        .battle-briefing,
        .battle-results-modal,
        .campaign-log-modal,
        .end-game-summary {
            display: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .game-title {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.7);
            background: linear-gradient(45deg, #b8860b, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            font-size: 1.2em;
            margin-bottom: 40px;
            color: #ccc;
            font-style: italic;
        }

        /* Vocabulary Support */
        .vocab-term {
            border-bottom: 2px dotted #ffd700;
            cursor: help;
            position: relative;
            display: inline-block;
        }

        .vocab-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #1a1a1a;
            color: #fff !important;
            padding: 12px 15px;
            border-radius: 8px;
            font-size: 0.9em;
            width: 280px;
            text-align: left;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1100;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            border: 1px solid #444;
            margin-bottom: 10px;
            white-space: normal;
        }

        .vocab-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: #1a1a1a;
        }

        .vocab-term:hover .vocab-tooltip,
        .vocab-term:focus .vocab-tooltip {
            opacity: 1;
            visibility: visible;
        }

        .vocab-definition {
            margin: 0;
            padding: 0;
            color: #f0f0f0 !important;
            font-size: inherit;
            line-height: 1.4;
        }


        /* Side Cards */
        .sides-container {
            display: flex;
            gap: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .side-card {
            background: rgba(255,255,255,0.1);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 30px;
            width: 320px;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            position: relative;
            overflow: hidden;
        }

        .side-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .union-card {
            border-color: #1e3a8a;
            background: linear-gradient(135deg, rgba(30,58,138,0.2), rgba(59,130,246,0.1));
        }

        .union-card:hover {
            border-color: #3b82f6;
            box-shadow: 0 10px 30px rgba(59,130,246,0.3);
        }

        .confederacy-card {
            border-color: #7f1d1d;
            background: linear-gradient(135deg, rgba(127,29,29,0.2), rgba(220,38,38,0.1));
        }

        .confederacy-card:hover {
            border-color: #dc2626;
            box-shadow: 0 10px 30px rgba(220,38,38,0.3);
        }

        .side-flag {
            font-size: 4em;
            margin-bottom: 20px;
            display: block;
        }

        .side-name {
            font-size: 1.8em;
            margin-bottom: 15px;
            font-weight: bold;
        }

        .side-description {
            font-size: 1em;
            line-height: 1.5;
            color: #ccc;
            margin-bottom: 15px;
        }

        .soldier-count {
            font-size: 1.1em;
            color: #ffd700;
            margin-bottom: 10px;
        }

        .victory-condition {
            font-size: 0.9em;
            color: #ffd700;
            font-style: italic;
            padding: 10px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
        }

        /* Side Introduction */
        .side-introduction {
            text-align: center;
            animation: fadeIn 0.5s ease-out;
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
        }

        .leader-message {
            background: rgba(0,0,0,0.5);
            border-radius: 15px;
            padding: 40px;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .leader-portrait {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto 20px;
            background: rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4em;
            border: 3px solid #ffd700;
        }

        .leader-name {
            font-size: 1.5em;
            color: #ffd700;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .message-text {
            font-size: 1.1em;
            line-height: 1.8;
            color: #f0f0f0;
            font-style: italic;
            text-align: left;
            max-width: 700px;
            margin: 0 auto 30px;
            white-space: pre-line;
        }

        .war-objectives {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .objectives-title {
            font-size: 1.3em;
            color: #ffd700;
            margin-bottom: 20px;
        }

        .objective-item {
            text-align: left;
            margin: 15px 0;
            padding-left: 30px;
            position: relative;
            font-size: 1.05em;
            line-height: 1.6;
        }

        .objective-item::before {
            content: '⚔️';
            position: absolute;
            left: 0;
            top: 0;
        }

        /* Battle Briefing Screen */
        .battle-briefing {
            text-align: center;
            animation: fadeIn 0.5s ease-out;
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
        }

        .briefing-header {
            margin-bottom: 30px;
        }

        .briefing-title {
            font-size: 2.2em;
            color: #ffd700;
            margin-bottom: 10px;
        }

        .briefing-date {
            font-size: 1.1em;
            color: #ccc;
            font-style: italic;
        }

        .battle-context {
            background: rgba(0,0,0,0.5);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            text-align: left;
        }

        .context-title {
            font-size: 1.4em;
            color: #ffd700;
            margin-bottom: 15px;
            text-align: center;
        }

        .context-text {
            font-size: 1.1em;
            line-height: 1.7;
            margin-bottom: 20px;
        }

        .battle-image {
            width: 100%;
            max-width: 600px;
            height: 250px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .battle-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
        }

        .image-credit {
            position: absolute;
            bottom: 5px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: #ccc;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.7em;
        }

        .strategic-choices {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .choices-title {
            font-size: 1.4em;
            color: #ffd700;
            margin-bottom: 20px;
            text-align: center;
        }

        .choice-option {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .choice-option:hover {
            background: rgba(255,255,255,0.15);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .choice-option.aggressive {
            border-color: rgba(220,38,38,0.5);
        }

        .choice-option.defensive {
            border-color: rgba(59,130,246,0.5);
        }

        .choice-option.tactical {
            border-color: rgba(168,85,247,0.5);
        }

        .choice-option:hover.aggressive {
            border-color: #dc2626;
            box-shadow: 0 5px 15px rgba(220,38,38,0.2);
        }

        .choice-option:hover.defensive {
            border-color: #3b82f6;
            box-shadow: 0 5px 15px rgba(59,130,246,0.2);
        }

        .choice-option:hover.tactical {
            border-color: #a855f7;
            box-shadow: 0 5px 15px rgba(168,85,247,0.2);
        }

        .choice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .choice-name {
            font-size: 1.3em;
            font-weight: bold;
            color: #ffd700;
        }

        .expand-icon {
            font-size: 1.2em;
            color: #ffd700;
            transition: transform 0.3s ease;
        }

        .choice-option.expanded .expand-icon {
            transform: rotate(180deg);
        }

        .choice-description {
            font-size: 1em;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .choice-details {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease, margin 0.3s ease;
            opacity: 0;
        }

        .choice-option.expanded .choice-details {
            max-height: 500px;
            opacity: 1;
            margin-top: 15px;
        }

        .choice-explanation {
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            padding: 12px;
            font-size: 0.95em;
            color: #ccc;
            border-left: 3px solid #ffd700;
            margin-bottom: 15px;
        }

        .choice-pros-cons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .pros, .cons {
            font-size: 0.9em;
        }

        .pros-title {
            color: #10b981;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .cons-title {
            color: #ef4444;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .pros ul, .cons ul {
            padding-left: 15px;
            margin: 0;
        }

        .pros li {
            color: #10b981;
            margin: 3px 0;
        }

        .cons li {
            color: #ef4444;
            margin: 3px 0;
        }

        .click-to-expand {
            text-align: center;
            color: #888;
            font-size: 0.9em;
            font-style: italic;
            margin-top: 20px;
            padding: 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 5px;
        }

        /* Buttons */
        .proceed-btn, .back-btn {
            padding: 15px 50px;
            font-size: 1.3em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Georgia', serif;
            font-weight: bold;
            transition: all 0.3s ease;
            margin: 10px;
        }

        .proceed-btn {
            background: linear-gradient(135deg, #ffd700, #f59e0b);
            color: #000;
        }

        .proceed-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 25px rgba(245,158,11,0.5);
        }

        .back-btn {
            background: rgba(255,255,255,0.1);
            color: #fff;
            border: 1px solid #666;
        }

        .back-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateX(-5px);
        }

        /* Game Screen */
        .game-screen {
            animation: fadeIn 0.5s ease-out;
            width: 100%;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 20px;
            background: rgba(0,0,0,0.5);
            border-radius: 10px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header-stat {
            font-size: 1.1em;
            padding: 10px 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            text-align: center;
        }

        .header-stat span {
            font-weight: bold;
            color: #ffd700;
        }

        .start-over-btn {
            padding: 10px 20px;
            font-size: 1em;
            background: linear-gradient(135deg, #dc2626, #ef4444);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Georgia', serif;
        }

        .start-over-btn:hover {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220,38,38,0.3);
        }

        .campaign-log-btn {
            padding: 10px 15px;
            font-size: 1em;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Georgia', serif;
            font-weight: bold;
        }

        .campaign-log-btn:hover {
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139,92,246,0.3);
        }

        /* Campaign Log Modal */
        .campaign-log-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1200;
            overflow-y: auto;
            padding: 20px;
        }

        .campaign-log-container {
            background: #1a1a1a;
            border-radius: 20px;
            padding: 30px;
            max-width: 900px;
            width: 90%;
            margin: 0 auto;
            animation: fadeIn 0.5s ease-out;
        }

        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 2px solid #333;
            padding-bottom: 15px;
        }

        .log-title {
            font-size: 2em;
            color: #ffd700;
            margin: 0;
        }

        .close-log-btn {
            font-size: 2em;
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .close-log-btn:hover {
            color: #fff;
            background: rgba(255,255,255,0.1);
        }

        .campaign-overview {
            margin-bottom: 30px;
        }

        .progress-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .summary-stat {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .summary-stat:hover {
            transform: translateY(-3px);
        }

        .stat-number {
            font-size: 2.2em;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #ccc;
            font-size: 0.9em;
        }

        .victory-progress {
            background: rgba(0,0,0,0.5);
            padding: 20px;
            border-radius: 10px;
        }

        .progress-title {
            color: #ffd700;
            margin-bottom: 15px;
            text-align: center;
        }

        .victory-bar {
            position: relative;
            height: 30px;
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            overflow: hidden;
        }

        .victory-fill {
            height: 100%;
            background: linear-gradient(90deg, #dc2626, #10b981);
            transition: width 0.5s ease;
            border-radius: 15px;
        }

        .victory-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        .battle-timeline {
            margin-bottom: 30px;
        }

        .timeline-title {
            color: #ffd700;
            margin-bottom: 20px;
            text-align: center;
        }

        .timeline-container {
            max-height: 300px;
            overflow-y: auto;
        }

        .timeline-item {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid;
            transition: all 0.3s ease;
        }

        .timeline-item:hover {
            background: rgba(255,255,255,0.1);
            transform: translateX(5px);
        }

        .timeline-item.victory {
            border-left-color: #10b981;
        }

        .timeline-item.defeat {
            border-left-color: #dc2626;
        }

        .timeline-battle {
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 5px;
        }

        .timeline-details {
            color: #ccc;
            font-size: 0.9em;
            line-height: 1.4;
        }

        .strategy-analysis {
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            padding: 20px;
        }

        .analysis-title {
            color: #ffd700;
            margin-bottom: 15px;
            text-align: center;
        }

        .strategy-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .strategy-type {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .strategy-name {
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 8px;
        }

        .strategy-count {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .strategy-success {
            font-size: 0.9em;
            color: #ccc;
        }

        /* Battle Results Modal */
        .battle-results-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 1100;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 20px;
            overflow-y: auto;
        }

        .battle-results-container {
            background: #1a1a1a;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 10px 50px rgba(0,0,0,0.5);
            max-width: 700px;
            width: 90%;
            animation: fadeIn 0.5s ease-out;
            margin: 20px auto;
            min-height: fit-content;
        }

        /* Ensure all content is visible */
        .battle-results-modal.show {
            align-items: flex-start;
            padding-top: 20px;
        }

        .battle-outcome {
            font-size: 3em;
            margin-bottom: 20px;
            font-weight: bold;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.7);
            padding: 15px 30px;
            border-radius: 10px;
            margin: 20px auto;
            display: inline-block;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .battle-victory {
            color: white;
            background: linear-gradient(135deg, #10b981, #059669);
            border: 3px solid #10b981;
            box-shadow: 0 0 30px rgba(16, 185, 129, 0.6);
            animation: victoryGlow 2s ease-in-out infinite;
        }

        .battle-defeat {
            color: white;
            background: linear-gradient(135deg, #dc2626, #991b1b);
            border: 3px solid #dc2626;
            box-shadow: 0 0 30px rgba(220, 38, 38, 0.6);
            animation: defeatPulse 2s ease-in-out infinite;
        }

        @keyframes victoryGlow {
            0%, 100% { 
                box-shadow: 0 0 30px rgba(16, 185, 129, 0.6);
                transform: scale(1);
            }
            50% { 
                box-shadow: 0 0 40px rgba(16, 185, 129, 0.8);
                transform: scale(1.02);
            }
        }

        @keyframes defeatPulse {
            0%, 100% { 
                box-shadow: 0 0 30px rgba(220, 38, 38, 0.6);
                opacity: 1;
            }
            50% { 
                box-shadow: 0 0 20px rgba(220, 38, 38, 0.4);
                opacity: 0.8;
            }
        }

        /* Results Summary Styles */
        .results-summary {
            background: rgba(0,0,0,0.5);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border: 2px solid rgba(255,215,0,0.3);
        }

        .result-card {
            text-align: center;
            margin-bottom: 20px;
        }

        .result-icon {
            font-size: 3em;
            margin-bottom: 10px;
            animation: bounceIn 0.6s ease-out;
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        .result-text {
            font-size: 1.3em;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 15px;
        }

        .impact-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .impact-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .impact-label {
            font-weight: bold;
            color: #ccc;
        }

        .impact-value {
            font-size: 1.1em;
            font-weight: bold;
        }

        .impact-value.casualties {
            color: #ef4444;
        }

        .impact-value.points {
            color: #10b981;
        }

        .impact-value.soldiers {
            color: #ffd700;
        }

        /* Outcome Highlights */
        .outcome-highlight {
            display: inline-block;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 1.2em;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin: 10px 0;
            animation: highlightPulse 2s ease-in-out infinite;
        }

        .victory-highlight {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: 2px solid #10b981;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
        }

        .defeat-highlight {
            background: linear-gradient(135deg, #dc2626, #991b1b);
            color: white;
            border: 2px solid #dc2626;
            box-shadow: 0 0 20px rgba(220, 38, 38, 0.4);
        }

        @keyframes highlightPulse {
            0%, 100% { 
                transform: scale(1); 
                opacity: 1;
            }
            50% { 
                transform: scale(1.05); 
                opacity: 0.9;
            }
        }

        .battle-explanation {
            background: rgba(0,0,0,0.5);
            border-radius: 10px;
            padding: 25px;
            margin: 25px 0;
            text-align: left;
        }

        .explanation-title {
            font-size: 1.4em;
            color: #ffd700;
            margin-bottom: 15px;
            text-align: center;
        }

        .explanation-text {
            font-size: 1.05em;
            line-height: 1.7;
            margin-bottom: 20px;
        }

        .historical-note {
            background: rgba(255,215,0,0.1);
            border-left: 4px solid #ffd700;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }

        .historical-note-title {
            color: #ffd700;
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .continue-battle-btn {
            padding: 15px 50px;
            font-size: 1.2em;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Georgia', serif;
            font-weight: bold;
            transition: all 0.3s ease;
            margin-top: 30px;
            margin-bottom: 10px;
        }

        .continue-battle-btn:hover {
            background: linear-gradient(135deg, #2563eb, #3b82f6);
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(37,99,235,0.4);
        }

        /* End Game Summary */
        .end-game-summary {
            text-align: center;
            animation: fadeIn 0.5s ease-out;
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
        }

        .outcome-banner {
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .victory-banner {
            background: linear-gradient(135deg, #059669, #10b981);
            box-shadow: 0 10px 30px rgba(16,185,129,0.3);
        }

        .defeat-banner {
            background: linear-gradient(135deg, #dc2626, #ef4444);
            box-shadow: 0 10px 30px rgba(220,38,38,0.3);
        }

        .outcome-title {
            font-size: 3em;
            margin-bottom: 10px;
            font-weight: bold;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
            color: white;
        }

        .outcome-subtitle {
            font-size: 1.3em;
            font-style: italic;
            color: rgba(255,255,255,0.9);
        }

        .final-stats-container {
            background: rgba(0,0,0,0.5);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .play-again-btn {
            padding: 15px 40px;
            font-size: 1.2em;
            background: linear-gradient(135deg, #ffd700, #f59e0b);
            color: #000;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Georgia', serif;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .play-again-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(245,158,11,0.4);
        }

        @media (max-width: 700px) {
            .game-container { padding: 10px; padding-left: 20px; }
            .game-title { font-size: 2em; }
            .side-card { width: 100%; max-width: 350px; }
            .sides-container { flex-direction: column; align-items: center; }
            .controls-panel { position: relative; bottom: auto; right: auto; margin: 20px auto; max-width: 90%; }
            .choice-pros-cons { grid-template-columns: 1fr; }
            .vocab-tooltip { width: 250px; }
            
            /* Mobile vocabulary sidebar */
            .vocab-sidebar {
                width: 90vw;
                max-width: 300px;
            }
            
            .vocab-toggle-btn {
                left: 10px;
                top: 10px;
                padding: 10px 12px;
                font-size: 0.9em;
            }
            
            /* Mobile responsive for Civil War intro */
            .civil-war-intro .intro-content > div[style*="grid"] {
                grid-template-columns: 1fr !important;
                gap: 15px !important;
            }
            
            .battle-results-container {
                padding: 20px;
                margin: 10px;
                width: 95%;
            }
            
            .battle-outcome {
                font-size: 2.2em;
                padding: 10px 20px;
            }
            
            .outcome-highlight {
                font-size: 1em;
                padding: 10px 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Vocabulary Sidebar -->
    <div class="vocab-sidebar" id="vocabSidebar">
        <h3>📚 Key Terms</h3>
        <ul class="vocab-list">
            <li class="vocab-item">
                <div class="vocab-term-name">Slavery</div>
                <div class="vocab-definition-text">The practice of owning people as property and forcing them to work without pay</div>
            </li>
            <li class="vocab-item">
                <div class="vocab-term-name">States' Rights</div>
                <div class="vocab-definition-text">The belief that each state should decide its own laws instead of the federal government</div>
            </li>
            <li class="vocab-item">
                <div class="vocab-term-name">Civil War</div>
                <div class="vocab-definition-text">A war fought between people from the same country</div>
            </li>
            <li class="vocab-item">
                <div class="vocab-term-name">Reinforcements</div>
                <div class="vocab-definition-text">Extra soldiers sent to help your army when you need them</div>
            </li>
            <li class="vocab-item">
                <div class="vocab-term-name">Flanking</div>
                <div class="vocab-definition-text">A military tactic of attacking the sides of an enemy formation</div>
            </li>
            <li class="vocab-item">
                <div class="vocab-term-name">Fortification</div>
                <div class="vocab-definition-text">Structures built to defend against attack</div>
            </li>
            <li class="vocab-item">
                <div class="vocab-term-name">Retreat</div>
                <div class="vocab-definition-text">Moving forces away from battle to a safer position</div>
            </li>
            <li class="vocab-item">
                <div class="vocab-term-name">Casualties</div>
                <div class="vocab-definition-text">Soldiers killed, wounded, or missing in battle</div>
            </li>
        </ul>
    </div>
    
    <!-- Vocabulary Toggle Button -->
    <button class="vocab-toggle-btn" id="vocabToggleBtn" onclick="toggleVocabSidebar()">📚 Terms</button>

    <!-- Language and Accessibility Controls -->
    <div class="controls-panel">
        <select class="translate-select" onchange="if(this.value) translateWithKagi(this.value); this.value='';">
            <option value="">🌐 Translate Page</option>
            <option value="Spanish">Español</option>
            <option value="French">Français</option>
            <option value="Portuguese">Português</option>
            <option value="Chinese">中文</option>
            <option value="Korean">한국어</option>
            <option value="Ukrainian">Українська</option>
            <option value="German">Deutsch</option>
            <option value="Japanese">日本語</option>
            <option value="Russian">Русский</option>
            <option value="Arabic">العربية</option>
        </select>
        <button onclick="resetIntroduction()" style="background: #444; color: #fff; border: none; padding: 4px 8px; border-radius: 4px; font-size: 0.8em; margin-top: 5px;">Reset Intro</button>
    </div>

    <div class="game-container">
        <!-- Side Selection Screen -->
        <div class="side-selection" id="sideSelection">
            <h1 class="game-title">Civil War Battle Simulation</h1>
            <p class="subtitle">Educational Edition - Learn History Through Strategy</p>
            
            <!-- Civil War Introduction - only shown on first visit -->
            <div class="civil-war-intro" id="civilWarIntro" style="display: none;">
                <h2 style="color: #ffd700; text-align: center; margin-bottom: 20px;">⚔️ The American Civil War (1861-1865) ⚔️</h2>
                
                <div class="intro-content">
                    <p style="font-size: 1.1em; line-height: 1.6; margin-bottom: 20px; text-align: center;">
                        From 1861 to 1865, Americans fought Americans in our nation's deadliest conflict. 
                        Over 600,000 people died fighting about <strong style="color: #ffd700;">slavery</strong> and whether states could leave the Union.
                    </p>
                    
                    <div style="background: rgba(255, 215, 0, 0.1); padding: 15px; border-radius: 10px; margin: 20px 0; text-align: center;">
                        <p style="font-size: 1em; line-height: 1.5; margin: 0;">
                            <strong>🎯 Your Mission:</strong> Command one side through 10 major battles, making the same tough decisions real generals faced!
                        </p>
                    </div>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <button onclick="hideIntroduction()" style="background: linear-gradient(135deg, #059669, #10b981); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-family: 'Georgia', serif; font-size: 1em;">
                            Continue to Side Selection →
                        </button>
                    </div>
                </div>
            </div>
            
            <h2 id="chooseSideHeading" style="color: #ffd700; text-align: center; margin: 30px 0 20px 0;">Choose Your Side</h2>
            
            <div class="sides-container">
                <div class="side-card union-card" id="unionCard">
                    <span class="side-flag">🇺🇸</span>
                    <h2 class="side-name">Union (The North)</h2>
                    <p class="side-description">
                        <strong>🏭 Industrial Powerhouse</strong><br>
                        You command President Lincoln's forces fighting to keep America united and end <strong style="color: #ffd700;">slavery</strong> forever. 
                        Use your factories, railroads, and larger population to crush the rebellion!
                    </p>
                    <div style="background: rgba(59, 130, 246, 0.2); padding: 10px; border-radius: 8px; margin: 10px 0;">
                        <p style="font-size: 0.9em; margin: 0;"><strong>Your Advantages:</strong> More <strong style="color: #ffd700;">reinforcements</strong>, better weapons, naval blockade</p>
                    </div>
                    <p class="soldier-count">Starting Army: 1,500,000 soldiers</p>
                    <p class="victory-condition">
                        🎯 Win 6 out of 10 battles to save the Union!
                    </p>
                </div>
                
                <div class="side-card confederacy-card" id="confederacyCard">
                    <span class="side-flag">🏴</span>
                    <h2 class="side-name">Confederacy (The South)</h2>
                    <p class="side-description">
                        <strong>⚔️ Scrappy Underdogs</strong><br>
                        Fight for <strong style="color: #ffd700;">states' rights</strong> and Southern independence! 
                        You're outnumbered, but your generals know the land and your soldiers fight for their homeland.
                    </p>
                    <div style="background: rgba(107, 114, 128, 0.2); padding: 10px; border-radius: 8px; margin: 10px 0;">
                        <p style="font-size: 0.9em; margin: 0;"><strong>Your Advantages:</strong> Better generals, home field, defensive tactics</p>
                    </div>
                    <p class="soldier-count">Starting Army: 1,000,000 soldiers</p>
                    <p class="victory-condition">
                        🎯 Win 5 out of 10 battles to gain independence!
                    </p>
                </div>
            </div>
        </div>
        
        <!-- Side Introduction Screen -->
        <div class="side-introduction" id="sideIntroduction">
            <div class="leader-message">
                <div class="leader-portrait" id="leaderPortrait">🎩</div>
                <h2 class="leader-name" id="leaderName">President Abraham Lincoln</h2>
                <div class="message-text" id="leaderMessage">
                    <!-- Message will be inserted here -->
                </div>
            </div>
            
            <div class="war-objectives">
                <h3 class="objectives-title">Your Mission</h3>
                <div id="objectivesList">
                    <!-- Objectives will be inserted here -->
                </div>
            </div>
            
            <button class="proceed-btn" id="proceedToGame">Begin Your Command</button>
            <button class="back-btn" id="backToSideBtn">← Choose Different Side</button>
        </div>
        
        <!-- Battle Briefing Screen -->
        <div class="battle-briefing" id="battleBriefing">
            <div class="briefing-header">
                <h2 class="briefing-title" id="briefingTitle">First Battle of Bull Run</h2>
                <p class="briefing-date" id="briefingDate">July 21, 1861</p>
            </div>
            
            <div class="battle-context">
                <h3 class="context-title">Historical Context</h3>
                <div class="context-text" id="contextText">
                    <!-- Battle context will be inserted here -->
                </div>
                
                <div class="battle-image" id="briefingImage">
                    <!-- Battle image will be inserted here -->
                </div>
            </div>
            
            <div class="strategic-choices">
                <h3 class="choices-title">Choose Your Strategy</h3>
                <p style="margin-bottom: 20px; color: #ccc; text-align: center;">
                    Click any strategy below to see details, then click again to make your decision!
                </p>
                
                <div id="choicesList">
                    <!-- Strategy choices will be inserted here -->
                </div>
            </div>
        </div>
        
        <!-- Game Screen (Battle Results) -->
        <div class="game-screen" id="gameScreen">
            <div class="game-header">
                <div class="header-stat">Score: <span id="score">0</span></div>
                <div class="header-stat">Soldiers: <span id="soldiers">0</span></div>
                <div class="header-stat">Battle <span id="battleNumber">1</span>/10</div>
                <div class="header-stat">Wins: <span id="wins">0</span></div>
                <button class="campaign-log-btn" id="campaignLogBtn">📊 Campaign Log</button>
                <button class="start-over-btn" id="startOverBtn">Start Over</button>
            </div>
        </div>

        <!-- Campaign Log Modal -->
        <div class="campaign-log-modal" id="campaignLogModal">
            <div class="campaign-log-container">
                <div class="log-header">
                    <h2 class="log-title">Your Campaign Progress</h2>
                    <button class="close-log-btn" id="closeLogBtn">&times;</button>
                </div>
                
                <div class="campaign-overview">
                    <div class="progress-summary">
                        <div class="summary-stat">
                            <div class="stat-number" id="battlesCompleted">3</div>
                            <div class="stat-label">Battles Fought</div>
                        </div>
                        <div class="summary-stat">
                            <div class="stat-number" id="winsCount">2</div>
                            <div class="stat-label">Victories</div>
                        </div>
                        <div class="summary-stat">
                            <div class="stat-number" id="currentScore">1,250</div>
                            <div class="stat-label">Total Score</div>
                        </div>
                    </div>
                    
                    <div class="victory-progress">
                        <h3 class="progress-title">Progress to Victory</h3>
                        <div class="victory-bar">
                            <div class="victory-fill" id="victoryFill" style="width: 33%"></div>
                            <div class="victory-text" id="victoryText">2 of 6 wins needed</div>
                        </div>
                    </div>
                </div>
                
                <div class="battle-timeline">
                    <h3 class="timeline-title">Battle Timeline</h3>
                    <div class="timeline-container" id="timelineContainer">
                        <!-- Timeline items will be inserted here -->
                    </div>
                </div>
                
                <div class="strategy-analysis">
                    <h3 class="analysis-title">Your Decision-Making</h3>
                    <div class="strategy-stats" id="strategyStats">
                        <!-- Strategy analysis will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Battle Results Modal -->
        <div class="battle-results-modal" id="battleResultsModal">
            <div class="battle-results-container">
                <h2 class="battle-outcome" id="battleOutcome"></h2>
                
                <!-- Quick Results Summary -->
                <div class="results-summary">
                    <div class="result-card">
                        <div class="result-icon" id="resultIcon">🏆</div>
                        <div class="result-text" id="resultText">Your strategy succeeded!</div>
                    </div>
                    
                    <div class="impact-stats">
                        <div class="impact-item">
                            <span class="impact-label">Casualties:</span>
                            <span class="impact-value casualties" id="casualtiesSummary">25,000 lost</span>
                        </div>
                        <div class="impact-item">
                            <span class="impact-label">Score:</span>
                            <span class="impact-value points" id="scoreSummary">+400 points</span>
                        </div>
                        <div class="impact-item">
                            <span class="impact-label">Army Size:</span>
                            <span class="impact-value soldiers" id="armySummary">975,000 remain</span>
                        </div>
                    </div>
                </div>
                
                <div class="battle-explanation">
                    <h3 class="explanation-title">What Happened?</h3>
                    <div class="explanation-text" id="explanationText">
                        <!-- Battle explanation will be inserted here -->
                    </div>
                    
                    <div class="historical-note">
                        <div class="historical-note-title">📚 Historical Note</div>
                        <div id="historicalNote">
                            <!-- Historical information will be inserted here -->
                        </div>
                    </div>
                </div>
                
                <button class="continue-battle-btn" id="continueBattleBtn">Continue to Next Battle</button>
            </div>
        </div>
        
        <!-- End Game Summary -->
        <div class="end-game-summary" id="endGameSummary">
            <div class="outcome-banner" id="outcomeBanner">
                <h1 class="outcome-title" id="outcomeTitle"></h1>
                <p class="outcome-subtitle" id="outcomeSubtitle">The Union is Preserved</p>
            </div>
            
            <div class="final-stats-container">
                <h2 style="color: #ffd700; margin-bottom: 20px;">Campaign Summary</h2>
                <div id="finalStatsText">
                    <!-- Final statistics will be inserted here -->
                </div>
            </div>
            
            <button class="play-again-btn" id="playAgainBtn">Play Again</button>
        </div>
    </div>

<script>
    // Game State
    let gameState = {
        side: null,
        currentBattle: 0,
        score: 0,
        soldiers: 0,
        wins: 0,
        losses: 0,
        battleHistory: []
    };

    // Settings
    let settings = {
        vocabHelp: true
    };

    // Complete battle data with all 10 battles
    const battles = [
        {
            name: "First Battle of Bull Run",
            date: "July 21, 1861",
            imageUrl: "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e6/Battle_of_Bull_Run.jpg/1024px-Battle_of_Bull_Run.jpg",
            imageCredit: "Kurz & Allison, 1889",
            context: "This was the first major battle of the Civil War. Both armies were made up mostly of volunteers who had never fought in a real battle before. Many people from Washington D.C. came out to watch, expecting it to be like a parade! The battle took place near a small creek called Bull Run in Virginia. Both sides thought the war would end quickly after one big battle.",
            strategies: [
                {
                    name: "Direct Attack",
                    description: "Order your troops to march straight at the enemy and attack their main force",
                    explanation: "This is the most straightforward approach - no fancy moves, just advance and fight. It can work if you have more soldiers or better equipment.",
                    pros: ["Simple to understand and execute", "Can overwhelm a weaker enemy", "Shows courage and determination"],
                    cons: ["Enemy can see you coming", "You might take heavy casualties", "No element of surprise"],
                    union: { win: false, soldierLoss: 45000, scoreGain: 100 },
                    confederacy: { win: true, soldierLoss: 30000, scoreGain: 400 }
                },
                {
                    name: "Defensive Position",
                    description: "Have your army dig in and wait for the enemy to attack you",
                    explanation: "Defense means letting the enemy come to you while you're in a strong position. Soldiers behind <span class='vocab-term'>fortifications<span class='vocab-tooltip'><div class='vocab-definition'>Structures built to defend against attack</div></span></span> are much harder to defeat.",
                    pros: ["Harder for enemy to hurt you", "You can choose the best ground", "Saves energy and supplies"],
                    cons: ["You give up the initiative", "Enemy might go around you", "Doesn't win territory"],
                    union: { win: false, soldierLoss: 25000, scoreGain: 200 },
                    confederacy: { win: true, soldierLoss: 15000, scoreGain: 300 }
                },
                {
                    name: "Flanking Movement",
                    description: "Try to march around the enemy's side and attack them from an unexpected direction",
                    explanation: "A <span class='vocab-term'>flanking<span class='vocab-tooltip'><div class='vocab-definition'>A military tactic of attacking the sides of an enemy formation</div></span></span> attack can surprise the enemy and force them to fight in two directions at once. It's risky because it splits your forces.",
                    pros: ["Element of surprise", "Can confuse the enemy", "Might cause enemy to retreat quickly"],
                    cons: ["Complex to coordinate", "Takes more time", "If it fails, you're in trouble"],
                    union: { win: false, soldierLoss: 35000, scoreGain: 150 },
                    confederacy: { win: true, soldierLoss: 20000, scoreGain: 350 }
                }
            ],
            results: {
                union_loss: "The Union army was defeated in their first major battle. Many soldiers panicked and ran back toward Washington D.C., mixing with the civilians who had come to watch. This showed both sides that the war would not be over quickly.",
                confederacy_victory: "The Confederate forces successfully defended Virginia and gained confidence that they could defeat the larger Union army. However, they were too disorganized to pursue the retreating Union forces back to Washington."
            },
            historical_notes: {
                general: "This battle convinced both North and South that the war would last longer than expected. It led to both sides recruiting larger, better-trained armies."
            }
        },
        {
            name: "Battle of Shiloh",
            date: "April 6-7, 1862",
            imageUrl: "https://upload.wikimedia.org/wikipedia/commons/thumb/b/b8/Thure_de_Thulstrup_-_Battle_of_Shiloh.jpg/1024px-Thure_de_Thulstrup_-_Battle_of_Shiloh.jpg",
            imageCredit: "Thure de Thulstrup, 1888",
            context: "General Ulysses S. Grant's Union army was camping near Shiloh Church in Tennessee when Confederate forces launched a surprise dawn attack. The Confederates hoped to destroy Grant's army before <span class='vocab-term'>reinforcements<span class='vocab-tooltip'><div class='vocab-definition'>Additional troops sent to strengthen a military force</div></span></span> could arrive. This was one of the bloodiest battles so far in the war.",
            strategies: [
                {
                    name: "Immediate Counterattack",
                    description: "Rally your surprised troops and attack back as quickly as possible",
                    explanation: "When you're surprised, sometimes the best defense is a quick offense. This can stop the enemy's momentum and show your soldiers you're still in control.",
                    pros: ["Stops enemy momentum", "Shows leadership", "Can turn surprise into opportunity"],
                    cons: ["Troops might be confused", "Haven't had time to plan", "Could lead to heavy losses"],
                    union: { win: true, soldierLoss: 40000, scoreGain: 400 },
                    confederacy: { win: false, soldierLoss: 55000, scoreGain: 150 }
                },
                {
                    name: "Form Defensive Lines",
                    description: "Organize your scattered forces into strong defensive positions",
                    explanation: "Getting organized and forming a solid line can stop a surprise attack. This gives you time to figure out what's happening and plan your next move.",
                    pros: ["Stops the panic", "Creates organized resistance", "Gives time to think"],
                    cons: ["Takes time you might not have", "Gives enemy more initiative", "Might seem like retreating"],
                    union: { win: true, soldierLoss: 35000, scoreGain: 350 },
                    confederacy: { win: false, soldierLoss: 45000, scoreGain: 200 }
                },
                {
                    name: "Strategic Retreat",
                    description: "Pull back to a better position and regroup your forces",
                    explanation: "Sometimes <span class='vocab-term'>retreating<span class='vocab-tooltip'><div class='vocab-definition'>Moving forces away from battle to a safer position</div></span></span> to better ground is the smart choice. It can save lives and let you fight on your terms.",
                    pros: ["Saves soldier's lives", "Gets you to better ground", "Gives time to plan"],
                    cons: ["Looks like giving up", "Enemy gains territory", "Hard to stop once started"],
                    union: { win: false, soldierLoss: 30000, scoreGain: 150 },
                    confederacy: { win: true, soldierLoss: 25000, scoreGain: 400 }
                }
            ],
            results: {
                union_victory: "Despite being surprised, Union forces managed to hold their ground and eventually push back the Confederate attack when reinforcements arrived the next day.",
                confederacy_defeat: "The Confederate surprise attack initially succeeded, but they couldn't finish off Grant's army before Union reinforcements arrived, turning victory into defeat."
            },
            historical_notes: {
                general: "This battle showed the importance of communication and coordination. It also demonstrated that the war was becoming more deadly - over 23,000 total casualties shocked both sides."
            }
        },
        {
            name: "Battle of Antietam",
            date: "September 17, 1862",
            imageUrl: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/aa/Battle_of_Antietam.png/1024px-Battle_of_Antietam.png",
            imageCredit: "Kurz & Allison, 1888",
            context: "Robert E. Lee's Confederate army invaded Maryland, hoping to bring the war to Union territory and maybe convince European countries to help the South. But Union forces found Lee's battle plans wrapped around some cigars! Now General McClellan knows exactly where Lee's forces are positioned. This could be the chance to end the rebellion.",
            strategies: [
                {
                    name: "Coordinated Assault",
                    description: "Use your knowledge of enemy positions to attack multiple points at once",
                    explanation: "Since you know where the enemy is, you can hit them everywhere at the same time. This prevents them from moving troops to help each other.",
                    pros: ["Enemy can't reinforce weak spots", "Uses your intelligence advantage", "Could end the war quickly"],
                    cons: ["Complex coordination required", "If one attack fails, all might fail", "Spreads your forces thin"],
                    union: { win: true, soldierLoss: 50000, scoreGain: 500 },
                    confederacy: { win: false, soldierLoss: 45000, scoreGain: 150 }
                },
                {
                    name: "Cautious Advance",
                    description: "Move slowly and carefully, making sure each position is secure",
                    explanation: "Even with enemy plans, battles are dangerous. Moving carefully ensures you don't fall into any traps and can retreat if needed.",
                    pros: ["Reduces risk of disaster", "Keeps army intact", "Maintains steady pressure"],
                    cons: ["Gives enemy time to react", "Might miss opportunities", "Could drag out the battle"],
                    union: { win: true, soldierLoss: 35000, scoreGain: 300 },
                    confederacy: { win: false, soldierLoss: 35000, scoreGain: 200 }
                },
                {
                    name: "Focus on Escape Routes",
                    description: "Try to cut off the Confederate army's retreat back to Virginia",
                    explanation: "Instead of just winning the battle, try to trap Lee's entire army. This could capture thousands of Confederate soldiers and end the war.",
                    pros: ["Could capture entire enemy army", "Would end the war quickly", "Prevents enemy from escaping"],
                    cons: ["Very difficult to execute", "Enemy might fight harder when trapped", "Risky if it fails"],
                    union: { win: true, soldierLoss: 60000, scoreGain: 600 },
                    confederacy: { win: false, soldierLoss: 55000, scoreGain: 100 }
                }
            ],
            results: {
                union_victory: "The Union army successfully used their intelligence advantage to defeat Lee's invasion. The Confederate army was forced to retreat back to Virginia.",
                confederacy_defeat: "Despite fighting bravely, the Confederate army was outmaneuvered and forced to abandon their invasion of the North."
            },
            historical_notes: {
                general: "This was the bloodiest single day in American military history, with over 22,000 casualties. The Union victory convinced European countries not to recognize the Confederacy."
            }
        },
        {
            name: "Battle of Gettysburg",
            date: "July 1-3, 1863",
            imageUrl: "https://upload.wikimedia.org/wikipedia/commons/thumb/f/f0/Thure_de_Thulstrup_-_L._Prang_and_Co._-_Battle_of_Gettysburg_-_Restoration_by_Adam_Cuerden.jpg/1024px-Thure_de_Thulstrup_-_L._Prang_and_Co._-_Battle_of_Gettysburg_-_Restoration_by_Adam_Cuerden.jpg",
            imageCredit: "Thure de Thulstrup, 1887",
            context: "This three-day battle in Pennsylvania is often called the turning point of the Civil War. Robert E. Lee's Confederate army had invaded the North, hoping a victory on Union soil would convince other countries to help the Confederacy and maybe end the war. The battle started by accident when Confederate soldiers looking for shoes encountered Union cavalry in the town of Gettysburg.",
            strategies: [
                {
                    name: "Hold the High Ground",
                    description: "Keep your forces on the hills and ridges around Gettysburg",
                    explanation: "High ground gives you huge advantages in battle - you can see farther, your cannons shoot farther, and it's harder for enemies to attack uphill. Cemetery Ridge and Little Round Top were key positions.",
                    pros: ["Artillery advantage", "Better visibility", "Harder to attack uphill"],
                    cons: ["Enemy might go around you", "Limited to defensive actions", "Harder to get supplies uphill"],
                    union: { win: true, soldierLoss: 35000, scoreGain: 600 },
                    confederacy: { win: false, soldierLoss: 50000, scoreGain: 150 }
                },
                {
                    name: "Attack the Center",
                    description: "Launch a massive assault on the enemy's main battle line",
                    explanation: "Sometimes a bold attack right at the enemy's strongest point can work - if you break through the center, you split their army in half. This is what 'Pickett's Charge' attempted to do.",
                    pros: ["If successful, splits enemy army", "Shows maximum courage", "Quick decision"],
                    cons: ["Attacking uphill is very difficult", "Heavy casualties expected", "Enemy can concentrate fire"],
                    union: { win: true, soldierLoss: 40000, scoreGain: 500 },
                    confederacy: { win: false, soldierLoss: 60000, scoreGain: 100 }
                },
                {
                    name: "Flanking Maneuver",
                    description: "Try to attack around the enemy's sides or behind them",
                    explanation: "Instead of attacking where the enemy expects, try to get around to their flanks or rear. This worked well for Lee in earlier battles, but the terrain at Gettysburg made it harder.",
                    pros: ["Avoids strongest defenses", "Can cause panic", "Element of surprise"],
                    cons: ["Takes time and coordination", "Terrain might not allow it", "Leaves your own flanks exposed"],
                    union: { win: true, soldierLoss: 30000, scoreGain: 550 },
                    confederacy: { win: false, soldierLoss: 45000, scoreGain: 200 }
                }
            ],
            results: {
                union_victory: "The Union army successfully defended their positions over three days. The famous 'Pickett's Charge' on the final day was repulsed with heavy Confederate losses, forcing Lee to retreat back to Virginia.",
                confederacy_defeat: "Lee's invasion of the North failed. The Confederate army suffered over 25,000 casualties and was forced to retreat. This marked the beginning of the end for Confederate hopes of victory."
            },
            historical_notes: {
                general: "Gettysburg is often called the turning point of the Civil War. After this defeat, the Confederacy would mostly fight defensive battles. President Lincoln later gave his famous Gettysburg Address at the dedication of the battlefield cemetery."
            }
        },
        {
            name: "Battle of Fredericksburg",
            date: "December 13, 1862",
            imageUrl: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d6/Battle_of_Fredericksburg%2C_Dec_13%2C_1862.png/1024px-Battle_of_Fredericksburg%2C_Dec_13%2C_1862.png",
            imageCredit: "Kurz & Allison, 1888",
            context: "General Burnside's Union army must cross the Rappahannock River and attack Confederate positions on Marye's Heights. Lee has had weeks to prepare his defenses, including a stone wall that creates a perfect <span class='vocab-term'>fortification<span class='vocab-tooltip'><div class='vocab-definition'>A structure built to defend against attack</div></span></span>. The Confederates have the high ground and are well-prepared.",
            strategies: [
                {
                    name: "Direct Assault",
                    description: "Attack the Confederate positions on Marye's Heights head-on",
                    explanation: "Sometimes courage and determination can overcome defensive advantages. A direct attack shows your soldiers you're committed to victory.",
                    pros: ["Shows determination", "Simple to execute", "Could overwhelm defenses"],
                    cons: ["Attacking uphill against fortifications", "Enemy has had time to prepare", "Likely to cause heavy casualties"],
                    union: { win: false, soldierLoss: 70000, scoreGain: 50 },
                    confederacy: { win: true, soldierLoss: 10000, scoreGain: 500 }
                },
                {
                    name: "Artillery Bombardment First",
                    description: "Use your cannons to soften enemy defenses before attacking",
                    explanation: "Cannon fire can damage enemy fortifications and force defenders to keep their heads down. This might make an assault more successful.",
                    pros: ["Weakens enemy defenses", "Provides cover for advancing troops", "Uses your artillery advantage"],
                    cons: ["Gives enemy warning", "Might not be effective against stone walls", "Uses up ammunition"],
                    union: { win: false, soldierLoss: 55000, scoreGain: 100 },
                    confederacy: { win: true, soldierLoss: 15000, scoreGain: 400 }
                },
                {
                    name: "Find Alternative Crossing",
                    description: "Look for another way to cross the river and avoid the prepared defenses",
                    explanation: "Instead of attacking where the enemy expects, try to find a different route. This takes time but might avoid the strongest defenses.",
                    pros: ["Avoids strongest enemy positions", "Element of surprise", "Could get behind enemy lines"],
                    cons: ["Takes more time", "Other crossings might be defended too", "Difficult in winter weather"],
                    union: { win: false, soldierLoss: 40000, scoreGain: 200 },
                    confederacy: { win: true, soldierLoss: 20000, scoreGain: 350 }
                }
            ],
            results: {
                union_loss: "The Union attacks failed with terrible losses. Wave after wave of brave soldiers fell before the Confederate defenses. Burnside was soon replaced as commander.",
                confederacy_victory: "Confederate forces held their strong defensive positions and inflicted heavy casualties on the attacking Union forces. The stone wall at Marye's Heights proved nearly impregnable."
            },
            historical_notes: {
                general: "This battle showed the deadly effectiveness of defensive positions in the Civil War. The improved weapons of the 1860s made frontal assaults extremely costly."
            }
        },
        {
            name: "Battle of Chancellorsville",
            date: "May 2-4, 1863",
            imageUrl: "https://upload.wikimedia.org/wikipedia/commons/thumb/b/b2/Battle_of_Chancellorsville.png/1024px-Battle_of_Chancellorsville.png",
            imageCredit: "Kurz & Allison, 1888",
            context: "General Hooker's large Union army faces Lee in the tangled wilderness of Virginia. Despite being outnumbered 2-to-1, Lee plans his most daring move yet: splitting his already smaller army to send Stonewall Jackson on a <span class='vocab-term'>flanking<span class='vocab-tooltip'><div class='vocab-definition'>An attack on the side of an enemy formation</div></span></span> march around the Union right flank. It's incredibly risky, but it might be the only way to win.",
            strategies: [
                {
                    name: "Hold Defensive Positions",
                    description: "Stay in your strong positions and let the enemy come to you",
                    explanation: "You have more soldiers and good defensive positions. Let Lee make the risky moves while you stay safe and strong.",
                    pros: ["Uses your numerical advantage", "Reduces risk", "Forces enemy to attack you"],
                    cons: ["Gives up initiative", "Enemy might outmaneuver you", "Doesn't press your advantages"],
                    union: { win: false, soldierLoss: 45000, scoreGain: 200 },
                    confederacy: { win: true, soldierLoss: 30000, scoreGain: 450 }
                },
                {
                    name: "Attack While Enemy is Divided",
                    description: "Strike hard while Lee's army is split in two",
                    explanation: "Lee has taken a huge risk by dividing his smaller army. If you attack quickly, you might destroy part of his force before they can reunite.",
                    pros: ["Enemy is vulnerable while divided", "Could destroy part of enemy army", "Takes advantage of enemy's risk"],
                    cons: ["Difficult to coordinate in the wilderness", "Might fall into a trap", "Could be caught by Jackson's flanking force"],
                    union: { win: true, soldierLoss: 40000, scoreGain: 500 },
                    confederacy: { win: false, soldierLoss: 35000, scoreGain: 150 }
                },
                {
                    name: "Withdraw to Open Ground",
                    description: "Pull back out of the wilderness to fight in more open terrain",
                    explanation: "The dense forest helps Lee's smaller army hide their movements. In open ground, your larger army would have more advantages.",
                    pros: ["Better terrain for larger army", "Easier to coordinate", "Reduces Lee's advantages"],
                    cons: ["Looks like retreating", "Gives up current positions", "Might encourage enemy"],
                    union: { win: false, soldierLoss: 35000, scoreGain: 250 },
                    confederacy: { win: true, soldierLoss: 25000, scoreGain: 400 }
                }
            ],
            results: {
                union_loss: "Jackson's surprise flank attack succeeded brilliantly, routing part of the Union army. However, Jackson was accidentally shot by his own men and died, a huge loss for the Confederacy.",
                confederacy_victory: "Lee and Jackson's bold plan worked perfectly, defeating a much larger enemy force. But the victory came at a terrible cost when Jackson was mortally wounded by friendly fire."
            },
            historical_notes: {
                general: "This battle is considered Lee's masterpiece of tactical brilliance. However, the death of Stonewall Jackson was a blow from which the Confederate army never recovered."
            }
        },
        {
            name: "Battle of Chickamauga",
            date: "September 19-20, 1863",
            imageUrl: "https://upload.wikimedia.org/wikipedia/commons/thumb/d/dd/Battle_of_Chickamauga.png/1024px-Battle_of_Chickamauga.png",
            imageCredit: "Kurz & Allison, 1890",
            context: "In the forests of northern Georgia, Confederate General Bragg's army has caught Union General Rosecrans' forces spread out and vulnerable. The thick woods make it hard to see what's happening, and both sides are confused. A mistake in Union orders has created a gap in their battle line - but will the Confederates be able to exploit it?",
            strategies: [
                {
                    name: "Exploit the Gap",
                    description: "Pour troops through the opening in the enemy line",
                    explanation: "A gap in the enemy line is like an open door - if you can get troops through it quickly, you can attack the enemy from behind and cause panic.",
                    pros: ["Could cause enemy collapse", "Attacks enemy from behind", "Creates confusion in enemy ranks"],
                    cons: ["Gap might be a trap", "Could get isolated", "Difficult to coordinate in thick forest"],
                    union: { win: false, soldierLoss: 55000, scoreGain: 100 },
                    confederacy: { win: true, soldierLoss: 35000, scoreGain: 500 }
                },
                {
                    name: "Steady Pressure",
                    description: "Attack all along the enemy line with coordinated pressure",
                    explanation: "Instead of gambling everything on one attack, apply pressure everywhere. This is safer and might find other weak points.",
                    pros: ["Reduces risk", "Tests entire enemy line", "Harder for enemy to concentrate defense"],
                    cons: ["Doesn't exploit specific advantages", "Might not achieve breakthrough", "Could lead to stalemate"],
                    union: { win: false, soldierLoss: 40000, scoreGain: 200 },
                    confederacy: { win: true, soldierLoss: 30000, scoreGain: 400 }
                },
                {
                    name: "Defensive Stand",
                    description: "Form strong defensive positions and let the enemy attack you",
                    explanation: "The confusion in the forest affects both sides. Sometimes the best move is to get organized and make the enemy come to you.",
                    pros: ["Reduces confusion", "Uses defensive advantages", "Conserves strength"],
                    cons: ["Gives up initiative", "Might miss opportunities", "Could allow enemy to escape"],
                    union: { win: false, soldierLoss: 35000, scoreGain: 250 },
                    confederacy: { win: true, soldierLoss: 25000, scoreGain: 350 }
                }
            ],
            results: {
                union_loss: "The Confederate breakthrough shattered part of the Union army, forcing them to retreat toward Chattanooga. Only General Thomas's heroic stand prevented complete disaster.",
                confederacy_victory: "Longstreet's corps smashed through the gap in Union lines, achieving one of the Confederacy's greatest tactical victories. However, they couldn't pursue effectively due to the difficult terrain."
            },
            historical_notes: {
                general: "This was one of the Confederacy's last major victories, but they failed to destroy the Union army completely. The Union retreat to Chattanooga led to a siege that would eventually favor the North."
            }
        },
        {
            name: "Battle of the Wilderness",
            date: "May 5-6, 1864",
            imageUrl: "",
            imageCredit: "",
            context: "General Grant begins his campaign to end the war by fighting Lee continuously. The battle takes place in the same tangled Virginia wilderness where Hooker was defeated a year earlier. The thick undergrowth makes it almost impossible to see, and forest fires threaten to burn wounded soldiers alive. Grant is determined to keep fighting unlike previous Union commanders.",
            strategies: [
                {
                    name: "Push Through Despite Losses",
                    description: "Keep attacking regardless of casualties to maintain pressure",
                    explanation: "Grant's strategy is to use the Union's advantage in numbers and supplies. Keep fighting and don't give Lee time to rest or maneuver.",
                    pros: ["Maintains constant pressure", "Uses numerical advantage", "Prevents enemy maneuvers"],
                    cons: ["Heavy casualties expected", "Forest fires create danger", "Difficult to coordinate in thick woods"],
                    union: { win: true, soldierLoss: 55000, scoreGain: 400 },
                    confederacy: { win: false, soldierLoss: 35000, scoreGain: 200 }
                },
                {
                    name: "Try to Outmaneuver",
                    description: "Move around the Confederate flanks instead of direct assault",
                    explanation: "Even in the wilderness, there might be ways to get around the enemy instead of fighting through them head-on.",
                    pros: ["Avoids strongest defenses", "Could get behind enemy", "Saves casualties"],
                    cons: ["Difficult in thick terrain", "Lee is expert at this kind of fighting", "Takes more time"],
                    union: { win: false, soldierLoss: 45000, scoreGain: 250 },
                    confederacy: { win: true, soldierLoss: 30000, scoreGain: 450 }
                },
                {
                    name: "Wait for Better Terrain",
                    description: "Try to draw Lee out of the wilderness to more favorable ground",
                    explanation: "The wilderness helps Lee's smaller army. If you can get him to fight in open ground, your advantages in numbers and artillery would be greater.",
                    pros: ["Better terrain for larger army", "Reduces Lee's advantages", "Safer for your forces"],
                    cons: ["Gives Lee initiative", "Might look like retreating", "Lee might not cooperate"],
                    union: { win: false, soldierLoss: 35000, scoreGain: 200 },
                    confederacy: { win: true, soldierLoss: 25000, scoreGain: 400 }
                }
            ],
            results: {
                union_victory: "Despite heavy losses, Grant achieved his goal of keeping Lee's army engaged. Unlike previous Union commanders, Grant continued south instead of retreating.",
                confederacy_defeat: "Lee fought brilliantly in familiar terrain, but couldn't stop Grant's relentless advance. For the first time, a Union commander wouldn't be stopped by tactical defeats."
            },
            historical_notes: {
                general: "This battle marked a new phase of the war. Grant's strategy of continuous fighting, regardless of individual battle outcomes, began the final grinding down of Confederate resistance."
            }
        },
        {
            name: "Battle of Atlanta",
            date: "July 22, 1864",
            imageUrl: "https://upload.wikimedia.org/wikipedia/commons/thumb/a/aa/Kurz_%26_Allison_-_Battle_of_Atlanta.jpg/1024px-Kurz_%26_Allison_-_Battle_of_Atlanta.jpg",
            imageCredit: "Kurz & Allison, 1888",
            context: "General Sherman's Union army threatens Atlanta, the industrial heart of the Confederacy. The city's factories produce weapons and supplies for Confederate armies, and its railroads connect the eastern and western parts of the South. Confederate General Hood has replaced the cautious Johnston and wants to attack Sherman's forces before they can capture the city.",
            strategies: [
                {
                    name: "Defend the City",
                    description: "Fortify Atlanta and make Sherman attack your prepared positions",
                    explanation: "Cities provide natural fortifications, and Atlanta's buildings and streets could help defenders. Make Sherman pay heavily for every block.",
                    pros: ["Uses urban defenses", "Protects vital industry", "Forces enemy to attack"],
                    cons: ["Could damage the city", "Civilians in danger", "If you lose, you lose everything"],
                    union: { win: true, soldierLoss: 30000, scoreGain: 550 },
                    confederacy: { win: false, soldierLoss: 45000, scoreGain: 150 }
                },
                {
                    name: "Attack Sherman's Supply Lines",
                    description: "Strike at the railroad lines bringing Sherman supplies",
                    explanation: "Armies need constant supplies of food and ammunition. If you can cut Sherman's supply lines, he might have to retreat.",
                    pros: ["Attacks enemy weakness", "Could force retreat", "Preserves your army"],
                    cons: ["Leaves Atlanta less defended", "Sherman might have enough supplies", "Cavalry raids are risky"],
                    union: { win: true, soldierLoss: 25000, scoreGain: 500 },
                    confederacy: { win: false, soldierLoss: 35000, scoreGain: 200 }
                },
                {
                    name: "Aggressive Field Battle",
                    description: "Attack Sherman's army in open battle before they reach Atlanta",
                    explanation: "Instead of waiting for a siege, attack Sherman while his army is spread out marching. This could catch them unprepared.",
                    pros: ["Takes initiative", "Could catch enemy unprepared", "Keeps battle away from city"],
                    cons: ["Sherman has more troops", "Risky without defensive advantages", "Could lose your army"],
                    union: { win: true, soldierLoss: 35000, scoreGain: 450 },
                    confederacy: { win: false, soldierLoss: 50000, scoreGain: 100 }
                }
            ],
            results: {
                union_victory: "Sherman's forces captured Atlanta after defeating Confederate attempts to stop them. The fall of this vital Confederate city was a huge blow to Southern morale.",
                confederacy_defeat: "Despite brave fighting, Confederate forces couldn't prevent the fall of Atlanta. The loss of this industrial center and railroad hub severely damaged the Confederate cause."
            },
            historical_notes: {
                general: "The fall of Atlanta was crucial to Lincoln's re-election in 1864. Sherman's famous telegram 'Atlanta is ours, and fairly won' helped convince Northern voters that the war could be won."
            }
        },
        {
            name: "Battle of Appomattox Court House",
            date: "April 9, 1865",
            imageUrl: "",
            imageCredit: "",
            context: "This is the end. Lee's Confederate army, hungry and exhausted, is surrounded near the small Virginia town of Appomattox Court House. Grant's forces have cut off their escape routes. Lee has perhaps 28,000 men left, while Grant has over 100,000. The Confederate cause is clearly lost, but some want to fight to the end while others think it's time to surrender and save lives.",
            strategies: [
                {
                    name: "Fight to the End",
                    description: "Continue fighting despite impossible odds",
                    explanation: "Some believe that surrender would dishonor the sacrifices already made. Fighting to the last man shows ultimate commitment to the cause.",
                    pros: ["Preserves honor", "Shows commitment", "Might inspire others"],
                    cons: ["Pointless loss of life", "Cause is already lost", "Could make peace terms worse"],
                    union: { win: true, soldierLoss: 15000, scoreGain: 600 },
                    confederacy: { win: false, soldierLoss: 25000, scoreGain: 50 }
                },
                {
                    name: "Attempt Breakout",
                    description: "Try to punch through Union lines and escape",
                    explanation: "Maybe there's still a chance to get away and continue the fight elsewhere. Even if most don't make it, some might escape to fight another day.",
                    pros: ["Might save part of the army", "Could continue resistance", "Avoids surrender"],
                    cons: ["Very unlikely to succeed", "Would cause more casualties", "Most would be captured anyway"],
                    union: { win: true, soldierLoss: 10000, scoreGain: 550 },
                    confederacy: { win: false, soldierLoss: 20000, scoreGain: 100 }
                },
                {
                    name: "Honorable Surrender",
                    description: "Negotiate surrender terms to save your soldiers' lives",
                    explanation: "The cause is lost, but the lives of your remaining soldiers are precious. An honorable surrender might allow them to go home to rebuild the South.",
                    pros: ["Saves lives", "Allows honorable end", "Soldiers can go home", "Begins healing process"],
                    cons: ["Admits defeat", "Ends the Confederate cause", "Some will see it as giving up"],
                    union: { win: true, soldierLoss: 0, scoreGain: 800 },
                    confederacy: { win: false, soldierLoss: 0, scoreGain: 400 }
                }
            ],
            results: {
                union_victory: "Lee chose to surrender to prevent further bloodshed. Grant's generous terms allowed Confederate soldiers to keep their horses and personal weapons, helping begin the healing process.",
                confederacy_defeat: "The Army of Northern Virginia surrendered, effectively ending the Civil War. Lee's decision to surrender rather than fight a hopeless battle saved thousands of lives."
            },
            historical_notes: {
                general: "Lee's surrender at Appomattox effectively ended the Civil War. Grant's generous terms and both commanders' dignified behavior helped set a tone for reunification rather than revenge."
            }
        }
    ];

    // Leader messages with educational content
    const leaderMessages = {
        union: {
            portrait: "🎩",
            name: "President Abraham Lincoln",
            message: "My fellow American,\n\nYou are about to take command of Union forces during our nation's greatest crisis. The <span class='vocab-term'>Civil War<span class='vocab-tooltip'><div class='vocab-definition'>A war fought between people from the same country</div></span></span> began because Southern states wanted to leave the United States to keep <span class='vocab-term'>slavery<span class='vocab-tooltip'><div class='vocab-definition'>The system where people could own other people and force them to work without pay</div></span></span> legal.\n\nAs a Union commander, you must make the same difficult decisions that real generals like Ulysses S. Grant and William T. Sherman faced. Every choice has consequences - for your soldiers, for civilians, and for the future of our country.\n\nRemember: we fight not just to win battles, but to preserve the idea that all people are created equal.\n\nGood luck, General.",
            objectives: [
                "Win 6 out of 10 major battles to restore the Union",
                "Learn about the real strategies used in the Civil War",
                "Understand how military decisions affected history",
                "Preserve as many soldiers as possible through smart tactics"
            ]
        },
        confederacy: {
            portrait: "🎖️",
            name: "President Jefferson Davis",
            message: "Commander,\n\nThe Confederate States of America needs your leadership in our fight for independence. We face the difficult challenge of defending our new nation against a larger, more industrial enemy.\n\nYou will command forces like those led by Robert E. Lee and Stonewall Jackson. Though we have fewer soldiers and fewer factories, we have skilled officers and the advantage of fighting on our home territory.\n\nYour decisions will determine whether the Confederacy can achieve independence or if we will be forced back into the Union.\n\nThe South depends on you.",
            objectives: [
                "Win 5 out of 10 major battles to secure Confederate independence",
                "Use superior tactics to overcome Union advantages in numbers",
                "Learn about the challenges faced by Confederate commanders",
                "Understand the military and political goals of the Confederacy"
            ]
        }
    };

    // DOM Elements
    let elements = {};

    // Initialize game
    function initializeGame() {
        elements = {
            sideSelection: document.getElementById('sideSelection'),
            sideIntroduction: document.getElementById('sideIntroduction'),
            battleBriefing: document.getElementById('battleBriefing'),
            gameScreen: document.getElementById('gameScreen'),
            battleResultsModal: document.getElementById('battleResultsModal'),
            campaignLogModal: document.getElementById('campaignLogModal'),
            endGameSummary: document.getElementById('endGameSummary'),
            unionCard: document.getElementById('unionCard'),
            confederacyCard: document.getElementById('confederacyCard'),
            proceedToGame: document.getElementById('proceedToGame'),
            backToSideBtn: document.getElementById('backToSideBtn'),
            startOverBtn: document.getElementById('startOverBtn'),
            continueBattleBtn: document.getElementById('continueBattleBtn'),
            campaignLogBtn: document.getElementById('campaignLogBtn'),
            closeLogBtn: document.getElementById('closeLogBtn'),
            playAgainBtn: document.getElementById('playAgainBtn'),
            vocabToggle: document.getElementById('vocabToggle')
        };

        // Check if this is first time playing - show introduction
        const hasSeenIntro = localStorage.getItem('civilWarIntroSeen');
        
        hideAllScreens();
        elements.sideSelection.style.display = 'block';
        
        if (!hasSeenIntro) {
            document.getElementById('civilWarIntro').style.display = 'block';
            // Hide the "Choose Your Side" heading and side cards
            document.getElementById('chooseSideHeading').style.display = 'none';
            document.querySelector('.sides-container').style.display = 'none';
            // Force re-render of vocabulary tooltips after display change
            setTimeout(() => {
                updateVocabularyDisplay();
                // Force browser to recalculate layout for tooltips
                const introVocabTerms = document.querySelectorAll('#civilWarIntro .vocab-term');
                introVocabTerms.forEach(term => {
                    term.style.position = 'relative'; // Ensure proper positioning context
                });
            }, 150);
        }
        
        setupEventListeners();
        updateVocabularyDisplay();
    }

    function setupEventListeners() {
        // Side selection
        elements.unionCard.addEventListener('click', () => selectSide('union'));
        elements.confederacyCard.addEventListener('click', () => selectSide('confederacy'));

        // Navigation
        elements.proceedToGame.addEventListener('click', startFirstBattle);
        elements.backToSideBtn.addEventListener('click', showSideSelection);
        elements.continueBattleBtn.addEventListener('click', continueToNextBattle);
        elements.playAgainBtn.addEventListener('click', resetGame);
        elements.startOverBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to start over?')) resetGame();
        });

        // Campaign log
        elements.campaignLogBtn.addEventListener('click', showCampaignLog);
        elements.closeLogBtn.addEventListener('click', closeCampaignLog);

        // Settings
        elements.vocabToggle.addEventListener('click', toggleVocabularyHelp);

        // Close modal when clicking outside
        elements.campaignLogModal.addEventListener('click', (e) => {
            if (e.target === elements.campaignLogModal) {
                closeCampaignLog();
            }
        });
    }

    function selectSide(side) {
        gameState.side = side;
        
        const leader = leaderMessages[side];
        document.getElementById('leaderPortrait').textContent = leader.portrait;
        document.getElementById('leaderName').textContent = leader.name;
        document.getElementById('leaderMessage').innerHTML = leader.message;
        
        const objectivesList = document.getElementById('objectivesList');
        objectivesList.innerHTML = '';
        leader.objectives.forEach(objective => {
            const item = document.createElement('div');
            item.className = 'objective-item';
            item.textContent = objective;
            objectivesList.appendChild(item);
        });
        
        showSideIntroduction();
    }

    function showSideSelection() {
        gameState.side = null;
        hideAllScreens();
        elements.sideSelection.style.display = 'block';
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function showSideIntroduction() {
        hideAllScreens();
        elements.sideIntroduction.style.display = 'block';
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function startFirstBattle() {
        gameState.soldiers = gameState.side === 'union' ? 1500000 : 1000000;
        gameState.currentBattle = 0;
        gameState.score = 0;
        gameState.wins = 0;
        gameState.losses = 0;
        gameState.battleHistory = [];
        
        showBattleBriefing();
    }

    function showBattleBriefing() {
        const battle = battles[gameState.currentBattle];
        
        document.getElementById('briefingTitle').textContent = battle.name;
        document.getElementById('briefingDate').textContent = battle.date;
        document.getElementById('contextText').innerHTML = battle.context;
        
        // Update battle image
        const briefingImage = document.getElementById('briefingImage');
        if (battle.imageUrl) {
            const img = new Image();
            img.onload = function() {
                briefingImage.innerHTML = `
                    <img src="${battle.imageUrl}" alt="${battle.name}">
                    <span class="image-credit">Source: ${battle.imageCredit}</span>
                `;
            };
            img.onerror = function() {
                briefingImage.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #888;">
                        <div style="font-size: 3em; margin-bottom: 10px;">⚔️</div>
                        <p>${battle.name}</p>
                        <p style="font-size: 0.9em; margin-top: 5px;">${battle.date}</p>
                    </div>
                `;
            };
            img.src = battle.imageUrl;
        } else {
            briefingImage.innerHTML = `
                <div style="text-align: center; padding: 40px; color: #888;">
                    <div style="font-size: 3em; margin-bottom: 10px;">⚔️</div>
                    <p>${battle.name}</p>
                    <p style="font-size: 0.9em; margin-top: 5px;">${battle.date}</p>
                </div>
            `;
        }
        
        // Create strategy choices with collapsible details
        const choicesList = document.getElementById('choicesList');
        choicesList.innerHTML = '';
        
        battle.strategies.forEach((strategy, index) => {
            const choiceDiv = document.createElement('div');
            choiceDiv.className = `choice-option ${index === 0 ? 'aggressive' : index === 1 ? 'defensive' : 'tactical'}`;
            choiceDiv.innerHTML = `
                <div class="choice-header">
                    <div class="choice-name">${strategy.name}</div>
                    <div class="expand-icon">▼</div>
                </div>
                <div class="choice-description">${strategy.description}</div>
                <div class="choice-details">
                    <div class="choice-explanation">${strategy.explanation}</div>
                    <div class="choice-pros-cons">
                        <div class="pros">
                            <div class="pros-title">✓ Advantages:</div>
                            <ul>
                                ${strategy.pros.map(pro => `<li>${pro}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="cons">
                            <div class="cons-title">✗ Risks:</div>
                            <ul>
                                ${strategy.cons.map(con => `<li>${con}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            `;
            
            // Add click handler for expanding details
            choiceDiv.addEventListener('click', (e) => {
                // Check if they clicked the expand area (not trying to make a decision)
                const isExpanded = choiceDiv.classList.contains('expanded');
                
                // First click expands, second click makes decision
                if (!isExpanded) {
                    // Collapse all other choices
                    document.querySelectorAll('.choice-option').forEach(option => {
                        option.classList.remove('expanded');
                    });
                    
                    // Expand this choice
                    choiceDiv.classList.add('expanded');
                } else {
                    // Make the decision
                    makeDecision(index);
                }
            });
            
            choicesList.appendChild(choiceDiv);
        });
        
        // Add instruction text
        const instructionDiv = document.createElement('div');
        instructionDiv.className = 'click-to-expand';
        instructionDiv.innerHTML = '💡 <strong>How it works:</strong> First click = see details • Second click = make decision';
        choicesList.appendChild(instructionDiv);
        
        hideAllScreens();
        elements.battleBriefing.style.display = 'block';
        elements.gameScreen.style.display = 'block';
        updateGameDisplay();
        window.scrollTo({ top: 0, behavior: 'smooth' });
        updateVocabularyDisplay();
    }

    function makeDecision(strategyIndex) {
        const battle = battles[gameState.currentBattle];
        const strategy = battle.strategies[strategyIndex];
        const result = strategy[gameState.side];
        
        applyBattleResult(result, strategy);
    }

    function applyBattleResult(result, strategy) {
        const battle = battles[gameState.currentBattle];
        
        if (result.win) {
            gameState.wins++;
        } else {
            gameState.losses++;
        }
        
        gameState.soldiers -= result.soldierLoss;
        gameState.soldiers = Math.max(0, gameState.soldiers);
        gameState.score += result.scoreGain;
        
        gameState.battleHistory.push({
            battleNumber: gameState.currentBattle + 1,
            name: battle.name,
            strategy: strategy.name,
            result: result.win ? 'Victory' : 'Defeat',
            casualties: result.soldierLoss
        });

        showBattleResults(result, strategy);
    }

    function showBattleResults(result, strategy) {
        const battle = battles[gameState.currentBattle];
        
        // Set outcome
        const outcomeEl = document.getElementById('battleOutcome');
        outcomeEl.textContent = result.win ? 'VICTORY!' : 'DEFEAT';
        outcomeEl.className = result.win ? 'battle-outcome battle-victory' : 'battle-outcome battle-defeat';
        
        // Set results summary (the new prominent section)
        document.getElementById('resultIcon').textContent = result.win ? '🏆' : '💀';
        document.getElementById('resultText').textContent = result.win ? 
            'Your strategy succeeded!' : 'Your strategy was defeated.';
        
        document.getElementById('casualtiesSummary').textContent = `${result.soldierLoss.toLocaleString()} lost`;
        document.getElementById('scoreSummary').textContent = `+${result.scoreGain} points`;
        document.getElementById('armySummary').textContent = `${gameState.soldiers.toLocaleString()} remain`;
        
        // Create detailed explanation with highlighted outcome
        const sideResult = gameState.side === 'union' ? 
            (result.win ? 'union_victory' : 'union_loss') : 
            (result.win ? 'confederacy_victory' : 'confederacy_defeat');
        
        const outcomeHighlight = result.win ? 
            '<span class="outcome-highlight victory-highlight">🎉 YOU WON THIS BATTLE! 🎉</span>' :
            '<span class="outcome-highlight defeat-highlight">💔 You lost this battle 💔</span>';
        
        document.getElementById('explanationText').innerHTML = `
            <div style="text-align: center; margin-bottom: 20px;">
                ${outcomeHighlight}
            </div>
            <p><strong>Your Strategy:</strong> ${strategy.name}</p>
            <p><strong>What Happened:</strong> ${battle.results[sideResult] || 'The battle outcome was determined by your strategic choice.'}</p>
            <p style="margin-top: 15px;"><strong>Why this happened:</strong> ${strategy.explanation.replace(/<[^>]*>/g, '')}</p>
        `;
        
        document.getElementById('historicalNote').textContent = battle.historical_notes.general;
        
        // Update button text
        if (gameState.currentBattle + 1 >= battles.length || gameState.soldiers <= 0) {
            elements.continueBattleBtn.textContent = 'View Final Results';
        } else {
            elements.continueBattleBtn.textContent = 'Continue to Next Battle';
        }
        
        updateGameDisplay();
        
        // Show modal and ensure it's scrolled to top
        elements.battleResultsModal.style.display = 'flex';
        elements.battleResultsModal.classList.add('show');
        
        // Scroll the page and modal to top
        setTimeout(() => {
            window.scrollTo({ top: 0, behavior: 'instant' });
            elements.battleResultsModal.scrollTop = 0;
        }, 50);
    }

    function continueToNextBattle() {
        elements.battleResultsModal.style.display = 'none';
        elements.battleResultsModal.classList.remove('show');
        
        gameState.currentBattle++;
        if (gameState.currentBattle >= battles.length || gameState.soldiers <= 0 || shouldEndGame()) {
            endGame();
        } else {
            showBattleBriefing();
        }
    }

    function shouldEndGame() {
        const requiredWins = gameState.side === 'union' ? 6 : 5;
        const battlesRemaining = battles.length - (gameState.currentBattle + 1);
        
        // End if we've won enough battles
        if (gameState.wins >= requiredWins) return true;
        
        // End if we can't possibly win
        if (gameState.wins + battlesRemaining < requiredWins) return true;
        
        // End if we've run out of soldiers
        if (gameState.soldiers <= 0) return true;
        
        return false;
    }

    function updateGameDisplay() {
        document.getElementById('score').textContent = gameState.score.toLocaleString();
        document.getElementById('soldiers').textContent = gameState.soldiers.toLocaleString();
        document.getElementById('wins').textContent = gameState.wins;
        document.getElementById('battleNumber').textContent = gameState.currentBattle + 1;
    }

    function endGame() {
        const requiredWins = gameState.side === 'union' ? 6 : 5;
        const victory = gameState.wins >= requiredWins && gameState.soldiers > 0;
        
        showEndGameSummary(victory);
    }

    function showEndGameSummary(victory) {
        hideAllScreens();
        
        const banner = document.getElementById('outcomeBanner');
        banner.className = victory ? 'outcome-banner victory-banner' : 'outcome-banner defeat-banner';
        
        document.getElementById('outcomeTitle').textContent = victory ? 'VICTORY!' : 'DEFEAT';
        document.getElementById('outcomeSubtitle').textContent = victory ? 
            (gameState.side === 'union' ? 'The Union is Preserved' : 'Confederate Independence Achieved') :
            (gameState.side === 'union' ? 'The Rebellion Continues' : 'The Confederacy Falls');
        
        const startingSoldiers = gameState.side === 'union' ? 1500000 : 1000000;
        const casualtyRate = Math.round(((startingSoldiers - gameState.soldiers) / startingSoldiers) * 100);
        
        document.getElementById('finalStatsText').innerHTML = `
            <div style="text-align: left; max-width: 600px; margin: 0 auto;">
                <h3 style="color: #ffd700; margin-bottom: 15px;">Your Performance:</h3>
                <p><strong>Final Score:</strong> ${gameState.score.toLocaleString()} points</p>
                <p><strong>Battles Won:</strong> ${gameState.wins} out of ${gameState.currentBattle} fought</p>
                <p><strong>Soldiers Lost:</strong> ${(startingSoldiers - gameState.soldiers).toLocaleString()} (${casualtyRate}% casualty rate)</p>
                <p><strong>Side:</strong> ${gameState.side === 'union' ? '🇺🇸 Union' : '🏴 Confederacy'}</p>
                
                <h3 style="color: #ffd700; margin: 20px 0 10px 0;">What You Learned:</h3>
                <p>You experienced the same difficult decisions that real Civil War commanders faced. Each battle presented unique challenges based on terrain, troop positions, and available resources.</p>
                
                <p style="margin-top: 15px;">
                    ${victory ? 
                        'Congratulations! Your strategic decisions led to victory. In the real Civil War, these battles helped determine the future of the United States.' :
                        'Although you didn\'t achieve victory, you learned about the challenges of Civil War command. Every battle taught lessons that real generals had to learn the hard way.'
                    }
                </p>
                
                <h3 style="color: #ffd700; margin: 20px 0 10px 0;">Battle Summary:</h3>
                <div style="background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px;">
                    ${gameState.battleHistory.map(battle => 
                        `<div style="margin: 5px 0; padding: 5px; border-left: 3px solid ${battle.result === 'Victory' ? '#10b981' : '#dc2626'};">
                            <strong>${battle.name}:</strong> ${battle.result === 'Victory' ? '✅' : '❌'} ${battle.result} 
                            (${battle.strategy}, ${battle.casualties.toLocaleString()} casualties)
                        </div>`
                    ).join('')}
                </div>
            </div>
        `;
        
        elements.endGameSummary.style.display = 'block';
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function hideAllScreens() {
        elements.sideSelection.style.display = 'none';
        elements.sideIntroduction.style.display = 'none';
        elements.battleBriefing.style.display = 'none';
        elements.gameScreen.style.display = 'none';
        elements.battleResultsModal.style.display = 'none';
        elements.campaignLogModal.style.display = 'none';
        elements.endGameSummary.style.display = 'none';
    }

    function showCampaignLog() {
        updateCampaignLog();
        elements.campaignLogModal.style.display = 'block';
    }

    function closeCampaignLog() {
        elements.campaignLogModal.style.display = 'none';
    }

    function updateCampaignLog() {
        // Update overview stats
        document.getElementById('battlesCompleted').textContent = gameState.battleHistory.length;
        document.getElementById('winsCount').textContent = gameState.wins;
        document.getElementById('currentScore').textContent = gameState.score.toLocaleString();

        // Update victory progress
        const requiredWins = gameState.side === 'union' ? 6 : 5;
        const progressPercent = Math.min((gameState.wins / requiredWins) * 100, 100);
        document.getElementById('victoryFill').style.width = `${progressPercent}%`;
        document.getElementById('victoryText').textContent = `${gameState.wins} of ${requiredWins} wins needed`;

        // Update battle timeline
        const timelineContainer = document.getElementById('timelineContainer');
        timelineContainer.innerHTML = '';

        if (gameState.battleHistory.length === 0) {
            timelineContainer.innerHTML = '<p style="text-align: center; color: #888; padding: 20px;">No battles fought yet.</p>';
        } else {
            gameState.battleHistory.forEach(battle => {
                const timelineItem = document.createElement('div');
                timelineItem.className = `timeline-item ${battle.result.toLowerCase()}`;
                timelineItem.innerHTML = `
                    <div class="timeline-battle">Battle ${battle.battleNumber}: ${battle.name}</div>
                    <div class="timeline-details">
                        Strategy: ${battle.strategy}<br>
                        Result: ${battle.result === 'Victory' ? '✅' : '❌'} ${battle.result}<br>
                        Casualties: ${battle.casualties.toLocaleString()} soldiers
                    </div>
                `;
                timelineContainer.appendChild(timelineItem);
            });
        }

        // Update strategy analysis
        updateStrategyAnalysis();
    }

    function updateStrategyAnalysis() {
        const strategyStats = document.getElementById('strategyStats');
        
        if (gameState.battleHistory.length === 0) {
            strategyStats.innerHTML = '<p style="text-align: center; color: #888;">Strategy analysis will appear after battles.</p>';
            return;
        }

        // Count strategy types used
        const strategies = {
            aggressive: { count: 0, wins: 0, names: ['Direct Attack', 'Immediate Counterattack', 'Coordinated Assault', 'Attack the Center', 'Direct Assault', 'Exploit the Gap', 'Push Through Despite Losses', 'Aggressive Field Battle', 'Fight to the End'] },
            defensive: { count: 0, wins: 0, names: ['Defensive Position', 'Form Defensive Lines', 'Hold the High Ground', 'Artillery Bombardment First', 'Hold Defensive Positions', 'Steady Pressure', 'Defensive Stand', 'Wait for Better Terrain', 'Defend the City'] },
            tactical: { count: 0, wins: 0, names: ['Flanking Movement', 'Strategic Retreat', 'Cautious Advance', 'Focus on Escape Routes', 'Flanking Maneuver', 'Find Alternative Crossing', 'Attack While Enemy is Divided', 'Withdraw to Open Ground', 'Try to Outmaneuver', 'Attack Sherman\'s Supply Lines', 'Attempt Breakout', 'Honorable Surrender'] }
        };

        gameState.battleHistory.forEach(battle => {
            let strategyType = 'tactical'; // default
            
            if (strategies.aggressive.names.includes(battle.strategy)) {
                strategyType = 'aggressive';
            } else if (strategies.defensive.names.includes(battle.strategy)) {
                strategyType = 'defensive';
            }

            strategies[strategyType].count++;
            if (battle.result === 'Victory') {
                strategies[strategyType].wins++;
            }
        });

        strategyStats.innerHTML = `
            <div class="strategy-type">
                <div class="strategy-name">Aggressive</div>
                <div class="strategy-count" style="color: #dc2626;">${strategies.aggressive.count}</div>
                <div class="strategy-success">${strategies.aggressive.count > 0 ? Math.round((strategies.aggressive.wins / strategies.aggressive.count) * 100) : 0}% success rate</div>
            </div>
            <div class="strategy-type">
                <div class="strategy-name">Defensive</div>
                <div class="strategy-count" style="color: #3b82f6;">${strategies.defensive.count}</div>
                <div class="strategy-success">${strategies.defensive.count > 0 ? Math.round((strategies.defensive.wins / strategies.defensive.count) * 100) : 0}% success rate</div>
            </div>
            <div class="strategy-type">
                <div class="strategy-name">Tactical</div>
                <div class="strategy-count" style="color: #7c3aed;">${strategies.tactical.count}</div>
                <div class="strategy-success">${strategies.tactical.count > 0 ? Math.round((strategies.tactical.wins / strategies.tactical.count) * 100) : 0}% success rate</div>
            </div>
        `;
    }


    function toggleVocabularyHelp() {
        settings.vocabHelp = !settings.vocabHelp;
        elements.vocabToggle.textContent = settings.vocabHelp ? 'Vocabulary Help: ON' : 'Vocabulary Help: OFF';
        elements.vocabToggle.classList.toggle('active', settings.vocabHelp);
        updateVocabularyDisplay();
    }

    function updateVocabularyDisplay() {
        const vocabTerms = document.querySelectorAll('.vocab-term');
        vocabTerms.forEach(term => {
            if (settings.vocabHelp) {
                term.style.borderBottom = '2px dotted #ffd700';
                term.style.cursor = 'help';
            } else {
                term.style.borderBottom = 'none';
                term.style.cursor = 'inherit';
            }
        });
    }

    function hideIntroduction() {
        // Mark introduction as seen
        localStorage.setItem('civilWarIntroSeen', 'true');
        
        // Hide introduction and show side selection
        document.getElementById('civilWarIntro').style.display = 'none';
        
        // Show the "Choose Your Side" heading and side cards
        document.getElementById('chooseSideHeading').style.display = 'block';
        document.querySelector('.sides-container').style.display = 'flex';
        
        // Update vocabulary display for new content
        updateVocabularyDisplay();
    }

    function resetGame() {
        gameState = {
            side: null,
            currentBattle: 0,
            score: 0,
            soldiers: 0,
            wins: 0,
            losses: 0,
            battleHistory: []
        };
        
        showSideSelection();
    }

    // For testing - reset introduction flag
    function resetIntroduction() {
        localStorage.removeItem('civilWarIntroSeen');
        location.reload();
    }

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeGame);
    } else {
        initializeGame();
    }
</script>

</body>
</html>
