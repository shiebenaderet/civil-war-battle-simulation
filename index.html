<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Civil War Battle Simulation - Educational Edition</title>

    <!-- Performance & Security Headers -->
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta name="referrer" content="no-referrer-when-downgrade">

    <!-- DNS prefetch for external resources -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">

    <!-- Asset Manifest - Public Domain Civil War Images -->
    <script type="application/json" id="assetManifest">[
        {
            "id": "fort_sumter",
            "title": "Battle of Fort Sumter",
            "url": "images/battle_of_fort_sumter.jpg",
            "credit": "Currier & Ives",
            "license": "Public Domain",
            "source": "Library of Congress"
        },
        {
            "id": "bull_run",
            "title": "First Battle of Bull Run",
            "url": "images/battle_of_bull_run.jpg",
            "credit": "Currier & Ives",
            "license": "Public Domain",
            "source": "Library of Congress"
        },
        {
            "id": "shiloh",
            "title": "Battle of Shiloh",
            "url": "images/battle_of_shiloh.jpg",
            "credit": "Thure de Thulstrup",
            "license": "Public Domain",
            "source": "Library of Congress"
        },
        {
            "id": "antietam",
            "title": "Battle of Antietam",
            "url": "images/battle_of_antietam.jpg",
            "credit": "Alexander Gardner",
            "license": "Public Domain",
            "source": "National Archives"
        },
        {
            "id": "fredericksburg",
            "title": "Battle of Fredericksburg",
            "url": "images/battle_of_fredericksburg.jpg",
            "credit": "Kurz & Allison",
            "license": "Public Domain",
            "source": "Library of Congress"
        },
        {
            "id": "chancellorsville",
            "title": "Battle of Chancellorsville",
            "url": "images/battle_of_chancellorsville.jpg",
            "credit": "Jedediah Hotchkiss",
            "license": "Public Domain",
            "source": "National Archives"
        },
        {
            "id": "vicksburg",
            "title": "Siege of Vicksburg",
            "url": "images/siege_of_vicksburg.jpg",
            "credit": "Kurz & Allison",
            "license": "Public Domain",
            "source": "Library of Congress"
        },
        {
            "id": "gettysburg",
            "title": "Battle of Gettysburg",
            "url": "images/battle_of_gettysburg.jpg",
            "credit": "Thure de Thulstrup",
            "license": "Public Domain",
            "source": "Library of Congress"
        },
        {
            "id": "chickamauga",
            "title": "Battle of Chickamauga",
            "url": "images/battle_of_chickamauga.jpg",
            "credit": "Kurz & Allison",
            "license": "Public Domain",
            "source": "Library of Congress"
        },
        {
            "id": "wilderness",
            "title": "Battle of the Wilderness",
            "url": "images/battle_of_the_wilderness.jpg",
            "credit": "Kurz & Allison",
            "license": "Public Domain",
            "source": "Library of Congress"
        },
        {
            "id": "atlanta",
            "title": "Battle of Atlanta",
            "url": "images/battle_of_atlanta.jpg",
            "credit": "Kurz & Allison",
            "license": "Public Domain",
            "source": "Library of Congress"
        },
        {
            "id": "shermans_march",
            "title": "Sherman's March to the Sea",
            "url": "images/shermans_march.jpg",
            "credit": "F.O.C. Darley",
            "license": "Public Domain",
            "source": "Library of Congress"
        },
        {
            "id": "appomattox",
            "title": "Surrender at Appomattox",
            "url": "images/surrender_appomattox.jpg",
            "credit": "Tom Lovell",
            "license": "Public Domain",
            "source": "National Archives"
        }
    ]</script>

    <!-- Google Fonts - Optimized Loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Crimson+Pro:wght@400;500;600&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Crimson+Pro:wght@400;500;600&display=swap" rel="stylesheet"></noscript>

    <!-- Google Translate Integration -->
    <script>
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en',
                includedLanguages: 'es,fr,pt,zh,ko,uk,ja,ru,ar',
                layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
                autoDisplay: false
            }, 'google_translate_element');
        }

        function translateWithGoogle(targetLanguage) {
            updateLanguageAttribute(targetLanguage);
            var langCode = getLanguageCode(targetLanguage);

            if (!document.querySelector('script[src*="translate.google.com"]')) {
                var script = document.createElement('script');
                script.src = 'https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit';
                script.async = true;
                script.onerror = function() {
                    console.warn('Google Translate requires internet access.');
                };
                document.head.appendChild(script);
            }

            // Poll for the Google Translate combo box (more reliable than fixed timeout)
            var attempts = 0;
            var pollInterval = setInterval(function() {
                attempts++;
                var select = document.querySelector('.goog-te-combo');
                if (select) {
                    clearInterval(pollInterval);
                    select.value = langCode;
                    select.dispatchEvent(new Event('change'));
                } else if (attempts >= 20) {
                    clearInterval(pollInterval);
                    console.warn('Google Translate did not load. Translation requires internet access.');
                }
            }, 500);
        }

        function getLanguageCode(language) {
            var languageCodes = {
                'Spanish': 'es', 'French': 'fr', 'Portuguese': 'pt',
                'Chinese': 'zh', 'Korean': 'ko', 'Ukrainian': 'uk',
                'Japanese': 'ja', 'Russian': 'ru', 'Arabic': 'ar'
            };
            return languageCodes[language] || 'en';
        }

        function updateLanguageAttribute(language) {
            document.documentElement.setAttribute('lang', getLanguageCode(language));
        }

        // Theme functions
        function toggleTheme() {
            var html = document.documentElement;
            var currentTheme = html.getAttribute('data-theme');
            var newTheme = currentTheme === 'light' ? 'dark' : 'light';

            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);

            var toggleBtn = document.getElementById('themeToggle');
            if (toggleBtn) {
                toggleBtn.querySelector('.theme-icon').textContent = newTheme === 'light' ? '\u{1F319}' : '\u2600\uFE0F';
                toggleBtn.setAttribute('aria-label', 'Switch to ' + (newTheme === 'light' ? 'dark' : 'light') + ' theme');
            }
        }

        function initializeTheme() {
            var savedTheme = localStorage.getItem('theme') || 'dark';
            var html = document.documentElement;

            html.setAttribute('data-theme', savedTheme);

            var toggleBtn = document.getElementById('themeToggle');
            if (toggleBtn) {
                toggleBtn.querySelector('.theme-icon').textContent = savedTheme === 'light' ? '\u{1F319}' : '\u2600\uFE0F';
                toggleBtn.setAttribute('aria-label', 'Switch to ' + (savedTheme === 'light' ? 'dark' : 'light') + ' theme');
            }
        }
    </script>

    <!-- Stylesheet -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body onload="initializeTheme()">
    <!-- Skip Navigation Link -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Google Translate Element -->
    <div id="google_translate_element"></div>

    <!-- Main Navigation Bar -->
    <nav class="main-navbar" role="navigation" aria-label="Main navigation">
        <div class="navbar-content">
            <div class="navbar-brand">
                <h1 class="nav-game-title">&#x2694;&#xFE0F; Civil War Simulation</h1>
                <span class="nav-subtitle">Educational Edition</span>
            </div>

            <div class="navbar-controls">
                <button class="nav-btn primary-action" id="campaignLogNavBtn" style="display: none;" aria-label="View campaign log" title="Campaign Log">
                    &#x1F4CA;
                </button>

                <div class="settings-dropdown">
                    <button class="nav-btn settings-btn" id="settingsBtn" aria-label="Open menu" aria-expanded="false" title="Menu">
                        &#x22EF;
                    </button>
                    <div class="settings-menu" id="settingsMenu" role="menu" aria-labelledby="settingsBtn">
                        <div class="menu-section">
                            <div class="menu-section-title">Appearance</div>
                            <button class="settings-item theme-toggle-item" id="themeToggle" onclick="toggleTheme()" role="menuitem" aria-label="Switch theme">
                                <span class="menu-icon theme-icon">&#x2600;&#xFE0F;</span> <span class="theme-text">Light Theme</span>
                            </button>
                            <div class="settings-item translate-item">
                                <span class="menu-icon">&#x1F310;</span>
                                <select class="translate-select-nav" id="translateSelect" onchange="if(this.value) translateWithGoogle(this.value);" aria-label="Change language">
                                    <option value="">English</option>
                                    <option value="Spanish">Espa&#xF1;ol</option>
                                    <option value="French">Fran&#xE7;ais</option>
                                    <option value="Korean">&#xD55C;&#xAD6D;&#xC5B4;</option>
                                    <option value="Ukrainian">&#x423;&#x43A;&#x440;&#x430;&#x457;&#x43D;&#x441;&#x44C;&#x43A;&#x430;</option>
                                    <option value="Russian">&#x420;&#x443;&#x441;&#x441;&#x43A;&#x438;&#x439;</option>
                                    <option value="Portuguese">Portugu&#xEA;s</option>
                                    <option value="Chinese">&#x4E2D;&#x6587;</option>
                                    <option value="Japanese">&#x65E5;&#x672C;&#x8A9E;</option>
                                </select>
                            </div>
                        </div>

                        <div class="settings-divider" id="gameActionsDiv" style="display: none;"></div>
                        <div class="menu-section" id="gameActionsSection" style="display: none;">
                            <div class="menu-section-title">Game</div>
                            <button class="settings-item danger-item" id="startOverNavBtn" role="menuitem">
                                <span class="menu-icon">&#x1F504;</span> Start Over
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="game-container" id="main-content" role="main" aria-label="Civil War Battle Simulation Game">

        <!-- ======================== -->
        <!-- MODE SELECTION SCREEN    -->
        <!-- ======================== -->
        <div class="screen" id="modeSelection" role="region" aria-label="Choose game mode">
            <h2 class="section-title">&#x2694;&#xFE0F; Civil War Battle Simulation</h2>
            <p class="subtitle">Experience the American Civil War (1861-1865) through 13 major battles</p>

            <div class="mode-cards">
                <div class="mode-card historical-mode-card" id="historicalModeCard" role="button" tabindex="0">
                    <div class="mode-icon">&#x1F4DC;</div>
                    <h3 class="mode-title">Historical Mode</h3>
                    <p class="mode-description">Experience the war as it actually happened. Make decisions, read primary sources, and reflect on what you learn.</p>
                    <ul class="mode-features">
                        <li>Interactive walkthrough of all 13 battles</li>
                        <li>Primary source quotes and technology highlights</li>
                        <li>Reflection questions for each battle</li>
                        <li>Download your responses as a PDF</li>
                    </ul>
                    <div class="mode-badge">Start Here</div>
                </div>

                <div class="mode-card freeplay-mode-card" id="freeplayModeCard" role="button" tabindex="0">
                    <div class="mode-icon">&#x1F3AF;</div>
                    <h3 class="mode-title">Free-play Mode</h3>
                    <p class="mode-description">Make your own strategic decisions and change the course of history. Fog of war adds unpredictable events to every battle.</p>
                    <ul class="mode-features">
                        <li>Choose strategies for each battle</li>
                        <li>Fog of war - random events change outcomes</li>
                        <li>Historical events that shaped real battles</li>
                        <li>Compete on the class leaderboard</li>
                    </ul>
                    <div class="mode-lock" id="freeplayLock">
                        &#x1F512; Complete Historical Mode to unlock
                    </div>
                </div>
            </div>

            <!-- Resume saved game prompt -->
            <div class="resume-prompt" id="resumePrompt" style="display: none;">
                <p class="resume-text">You have a saved game in progress.</p>
                <div class="resume-actions">
                    <button class="btn-primary" id="resumeBtn">Continue Where You Left Off</button>
                    <button class="btn-secondary" id="newGameBtn">Start Fresh</button>
                </div>
            </div>
        </div>

        <!-- ============================== -->
        <!-- STUDENT NAME SCREEN            -->
        <!-- ============================== -->
        <div class="screen" id="studentNameScreen" style="display:none;" role="region" aria-label="Enter your name">
            <div class="name-screen-content">
                <div class="name-screen-icon" aria-hidden="true">&#x1F4CB;</div>
                <h2 class="section-title">Welcome, Historian</h2>
                <p class="subtitle">Enter your name for your official response sheet</p>

                <div class="name-form">
                    <div class="name-fields">
                        <div class="name-field">
                            <label for="firstNameInput" class="name-field-label">First Name</label>
                            <input type="text" id="firstNameInput" class="name-field-input" placeholder="Sarah" maxlength="20" autocomplete="given-name" aria-label="Your first name">
                        </div>
                        <div class="name-field name-field-initial">
                            <label for="lastInitialInput" class="name-field-label">Last Initial</label>
                            <input type="text" id="lastInitialInput" class="name-field-input initial-input" placeholder="J" maxlength="1" aria-label="Your last initial">
                        </div>
                    </div>
                    <button class="btn-primary name-continue-btn" id="nameContinueBtn">Continue</button>
                </div>
            </div>
            <button class="back-btn" id="backToModeFromName">&#x2190; Back to Mode Selection</button>
        </div>

        <!-- ======================== -->
        <!-- SIDE SELECTION SCREEN    -->
        <!-- ======================== -->
        <div class="screen" id="sideSelection" style="display:none;" role="region" aria-label="Choose your side">
            <h2 class="section-title">Choose Your Side</h2>
            <p class="subtitle" id="sideSelectionSubtitle">Experience these battles from the perspective you choose</p>

            <div class="sides-container">
                <div class="side-card union-card" id="unionCard" role="button" tabindex="0" aria-label="Play as the Union">
                    <span class="side-flag" aria-hidden="true">&#x1F1FA;&#x1F1F8;</span>
                    <h2 class="side-name">Union (The North)</h2>
                    <p class="side-description">
                        <strong>&#x1F3ED; Industrial Powerhouse</strong><br>
                        Command President Lincoln's forces fighting to keep America united and end slavery forever.
                    </p>
                    <p class="soldier-count" id="unionSoldierCount"></p>
                </div>

                <div class="side-card confederacy-card" id="confederacyCard" role="button" tabindex="0" aria-label="Play as the Confederacy">
                    <span class="side-flag" aria-hidden="true">&#x1F3F4;</span>
                    <h2 class="side-name">Confederacy (The South)</h2>
                    <p class="side-description">
                        <strong>&#x2694;&#xFE0F; Defending the South</strong><br>
                        Fight for Southern independence. Outnumbered but with skilled generals and home territory advantage.
                    </p>
                    <p class="soldier-count" id="confederacySoldierCount"></p>
                </div>
            </div>

            <button class="back-btn" id="backToModeBtn">&#x2190; Back to Mode Selection</button>
        </div>

        <!-- ============================== -->
        <!-- LEADER LETTER SCREEN           -->
        <!-- ============================== -->
        <div class="screen" id="leaderLetterScreen" style="display:none;" role="region" aria-label="Message from your leader">
            <div class="letter-wrapper">
                <div class="letter-paper">
                    <div class="letter-header-section">
                        <div class="letter-seal" id="letterSeal" aria-hidden="true"></div>
                        <div class="letter-from" id="letterFrom"></div>
                        <div class="letter-date" id="letterDate"></div>
                    </div>
                    <div class="letter-salutation" id="letterSalutation"></div>
                    <div class="letter-body" id="letterBody"></div>
                    <div class="letter-closing" id="letterClosing"></div>
                    <div class="letter-signature" id="letterSignature"></div>
                    <div class="letter-title" id="letterTitle"></div>
                </div>
            </div>
            <div class="letter-actions">
                <button class="btn-primary letter-begin-btn" id="beginJourneyBtn">Begin Your Journey</button>
            </div>
        </div>

        <!-- ================================= -->
        <!-- HISTORICAL MODE: BATTLE SCREEN    -->
        <!-- ================================= -->
        <div class="screen" id="historicalScreen" style="display:none;" role="region" aria-label="Historical battle">
            <!-- Progress bar -->
            <div class="battle-progress">
                <div class="progress-label" id="historicalProgressLabel">Battle 1 of 13</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="historicalProgressFill" style="width: 7.7%"></div>
                </div>
            </div>

            <!-- Battle header -->
            <div class="battle-header">
                <h2 class="battle-name" id="histBattleName"></h2>
                <div class="battle-meta">
                    <span class="battle-date" id="histBattleDate"></span>
                    <span class="battle-location" id="histBattleLocation"></span>
                </div>
            </div>

            <!-- Battle image -->
            <div class="battle-image-container" id="histBattleImage"></div>

            <!-- Narrative sections - revealed progressively -->
            <div class="narrative-sections" id="narrativeSections">

                <!-- Section 1: Intel Report -->
                <div class="narrative-section intel-section" id="sectionIntel">
                    <h3 class="narrative-heading">&#x1F4CB; Intel Report</h3>
                    <div class="intel-grid" id="histIntelGrid">
                        <!-- Rendered by JS -->
                    </div>
                </div>

                <!-- Section 2: The Situation -->
                <div class="narrative-section situation-section" id="sectionSituation" style="display:none;">
                    <h3 class="narrative-heading">&#x1F5FA;&#xFE0F; The Situation</h3>
                    <p class="narrative-text" id="histSituation"></p>
                </div>

                <!-- Section 3: What Would You Do? -->
                <div class="narrative-section wwyd-section" id="sectionWWYD" style="display:none;">
                    <h3 class="narrative-heading">&#x1F914; What Would You Do?</h3>
                    <p class="wwyd-prompt" id="histWWYDPrompt"></p>
                    <div class="wwyd-options" id="histWWYDOptions" role="group" aria-label="Choose what you would do">
                        <!-- Rendered by JS -->
                    </div>
                </div>

                <!-- Section 4: What Really Happened + Tech -->
                <div class="narrative-section happened-section" id="sectionHappened" style="display:none;">
                    <h3 class="narrative-heading">&#x1F4D6; What Really Happened</h3>
                    <p class="narrative-text" id="histWhatHappened"></p>

                    <div class="outcome-box" id="histOutcomeBox">
                        <div class="outcome-label">Historical Outcome</div>
                        <div class="outcome-result" id="histOutcome"></div>
                        <div class="outcome-casualties" id="histCasualties"></div>
                    </div>

                    <div class="tech-highlight" id="histTechBox">
                        <div class="tech-label">&#x2699;&#xFE0F; Technology Spotlight</div>
                        <div class="tech-name" id="histTechName"></div>
                        <p class="tech-description" id="histTechDesc"></p>
                    </div>
                </div>

                <!-- Section 5: A Voice From the War -->
                <div class="narrative-section voice-section" id="sectionVoice" style="display:none;">
                    <h3 class="narrative-heading">&#x1F4AC; A Voice From the War</h3>
                    <blockquote class="voice-quote" id="histVoiceQuote"></blockquote>
                    <div class="voice-attribution" id="histVoiceAttribution"></div>
                    <div class="voice-source" id="histVoiceSource"></div>
                </div>

                <!-- Section 6: The Bigger Picture -->
                <div class="narrative-section bigger-picture-section" id="sectionBigPicture" style="display:none;">
                    <h3 class="narrative-heading">&#x1F30D; The Bigger Picture</h3>
                    <p class="narrative-text" id="histBigPicture"></p>

                    <div class="key-fact-box">
                        <div class="key-fact-label">&#x1F4A1; Did You Know?</div>
                        <p class="key-fact-text" id="histKeyFact"></p>
                    </div>

                    <div class="perspectives-container" id="histPerspectives"></div>
                </div>

                <!-- Section 7: Reflect -->
                <div class="narrative-section reflect-section" id="sectionReflect" style="display:none;">
                    <h3 class="narrative-heading">&#x270D;&#xFE0F; Reflect</h3>
                    <p class="reflect-prompt" id="histReflectPrompt"></p>
                    <textarea class="reflect-input" id="histReflectInput" rows="4" placeholder="Write your thoughts here..." aria-label="Your reflection"></textarea>
                </div>
            </div>

            <!-- Navigation buttons -->
            <div class="narrative-nav">
                <button class="btn-primary" id="narrativeContinueBtn">Continue</button>
            </div>
        </div>

        <!-- ============================= -->
        <!-- FREE-PLAY: BATTLE BRIEFING    -->
        <!-- ============================= -->
        <div class="screen" id="freeplayBriefing" style="display:none;" role="region" aria-label="Battle briefing and strategy selection">
            <div class="freeplay-status">
                <div class="battle-progress">
                    <div class="progress-label" id="freeplayProgressLabel">Battle 1 of 13</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="freeplayProgressFill" style="width: 7.7%"></div>
                    </div>
                </div>
                <div class="war-stats">
                    <div class="stat-item">
                        <span class="stat-label">Wins</span>
                        <span class="stat-value" id="statWins">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Losses</span>
                        <span class="stat-value" id="statLosses">0</span>
                    </div>
                    <div class="stat-item momentum-stat">
                        <span class="stat-label">Momentum</span>
                        <span class="stat-value" id="statMomentum">0</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Army</span>
                        <span class="stat-value" id="statSoldiers">1,500,000</span>
                    </div>
                </div>
            </div>

            <div class="battle-header">
                <h2 class="battle-name" id="fpBattleName"></h2>
                <div class="battle-meta">
                    <span class="battle-date" id="fpBattleDate"></span>
                    <span class="battle-location" id="fpBattleLocation"></span>
                </div>
            </div>

            <div class="battle-image-container" id="fpBattleImage"></div>

            <div class="briefing-text">
                <h3 class="briefing-label">Situation Report</h3>
                <p class="briefing-content" id="fpBriefing"></p>
            </div>

            <!-- Historical event notice (if applicable) -->
            <div class="historical-event-notice" id="fpHistEventNotice" style="display:none;">
                <div class="hist-event-label">&#x1F4DC; Historical Event</div>
                <p class="hist-event-text" id="fpHistEventText"></p>
            </div>

            <div class="strategy-choices" role="group" aria-label="Choose your strategy">
                <h3 class="choices-heading">Choose Your Strategy</h3>
                <div class="strategy-list" id="strategyList"></div>
            </div>
        </div>

        <!-- ============================= -->
        <!-- FREE-PLAY: BATTLE RESULTS     -->
        <!-- ============================= -->
        <div class="screen" id="freeplayResults" style="display:none;" role="region" aria-label="Battle results">
            <div class="result-banner" id="resultBanner">
                <h2 class="result-title" id="resultTitle">VICTORY!</h2>
            </div>

            <div class="result-details">
                <p class="result-outcome" id="resultOutcome"></p>

                <!-- Fog of War / Historical Event display -->
                <div class="fog-of-war-section" id="fogOfWarSection" style="display:none;">
                    <div class="fog-event" id="fogEventDisplay">
                        <span class="fog-label">&#x1F32B;&#xFE0F; Fog of War:</span>
                        <span class="fog-text" id="fogEventText"></span>
                        <span class="fog-mod" id="fogEventMod"></span>
                    </div>
                    <div class="hist-event" id="histEventDisplay" style="display:none;">
                        <span class="fog-label">&#x1F4DC; Historical Event:</span>
                        <span class="fog-text" id="histEventText"></span>
                        <span class="fog-mod" id="histEventMod"></span>
                    </div>
                </div>

                <!-- Power breakdown -->
                <div class="power-breakdown" id="powerBreakdown">
                    <div class="power-label">Battle Power Breakdown</div>
                    <div class="power-items" id="powerItems">
                        <!-- Rendered by JS -->
                    </div>
                    <div class="power-total">
                        <span>Effective Power:</span>
                        <span id="powerTotal">0</span>
                        <span class="power-vs">vs Difficulty:</span>
                        <span id="powerDifficulty">0</span>
                    </div>
                </div>

                <div class="result-stats">
                    <div class="result-stat">
                        <span class="result-stat-label">Casualties</span>
                        <span class="result-stat-value" id="resultCasualties">25,000</span>
                    </div>
                    <div class="result-stat">
                        <span class="result-stat-label">Score</span>
                        <span class="result-stat-value" id="resultScore">+400</span>
                    </div>
                    <div class="result-stat">
                        <span class="result-stat-label">Momentum</span>
                        <span class="result-stat-value" id="resultMomentum">+2</span>
                    </div>
                    <div class="result-stat">
                        <span class="result-stat-label">Army Size</span>
                        <span class="result-stat-value" id="resultArmy">975,000</span>
                    </div>
                </div>

                <div class="momentum-meter">
                    <div class="momentum-label">War Momentum</div>
                    <div class="momentum-bar">
                        <div class="momentum-negative-zone"></div>
                        <div class="momentum-positive-zone"></div>
                        <div class="momentum-marker" id="momentumMarker" style="left: 50%"></div>
                    </div>
                    <div class="momentum-labels">
                        <span>Enemy Winning</span>
                        <span>Even</span>
                        <span>You're Winning</span>
                    </div>
                </div>
            </div>

            <button class="btn-primary" id="nextBattleBtn">Continue to Next Battle</button>
        </div>

        <!-- ============================= -->
        <!-- CAMPAIGN LOG MODAL            -->
        <!-- ============================= -->
        <div class="modal" id="campaignLogModal" style="display:none;">
            <div class="modal-container">
                <div class="modal-header">
                    <h2 class="modal-title">Campaign Progress</h2>
                    <button class="modal-close" id="closeLogBtn">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="campaign-overview">
                        <div class="progress-summary">
                            <div class="summary-stat">
                                <div class="stat-number" id="logBattlesFought">0</div>
                                <div class="stat-label">Battles</div>
                            </div>
                            <div class="summary-stat">
                                <div class="stat-number" id="logWins">0</div>
                                <div class="stat-label">Wins</div>
                            </div>
                            <div class="summary-stat">
                                <div class="stat-number" id="logScore">0</div>
                                <div class="stat-label">Score</div>
                            </div>
                            <div class="summary-stat">
                                <div class="stat-number" id="logMomentum">0</div>
                                <div class="stat-label">Momentum</div>
                            </div>
                        </div>
                    </div>
                    <div class="battle-timeline" id="logTimeline"></div>
                </div>
            </div>
        </div>

        <!-- ============================= -->
        <!-- END GAME SUMMARY              -->
        <!-- ============================= -->
        <div class="screen" id="endGameScreen" style="display:none;" role="region" aria-label="Game results">
            <div class="outcome-banner" id="endBanner">
                <h1 class="outcome-title" id="endTitle">VICTORY!</h1>
                <p class="outcome-subtitle" id="endSubtitle">The Union is Preserved</p>
            </div>

            <div id="endContent"></div>

            <!-- PDF export button (historical mode) -->
            <div id="pdfExportSection" class="pdf-export-section" style="display:none;">
                <button class="btn-primary pdf-export-btn" id="exportPdfBtn">&#x1F4C4; Download Response Sheet (PDF)</button>
                <p class="pdf-hint">Opens a printable page. Use Print &rarr; Save as PDF to submit on Canvas.</p>
            </div>

            <!-- Scoreboard (free-play only) -->
            <div id="scoreboardSection" class="scoreboard-section" style="display:none;"></div>

            <!-- Image Credits -->
            <div class="image-credits-section">
                <button class="credits-toggle" id="creditsToggle" aria-expanded="false" aria-controls="creditsContent" type="button">
                    <span class="credits-icon">&#x1F4F7;</span>
                    <span class="credits-text">View Image Credits</span>
                    <span class="credits-arrow">&#x25BC;</span>
                </button>

                <div class="credits-content" id="creditsContent" aria-hidden="true">
                    <h3>Image Credits &amp; Sources</h3>
                    <p class="credits-note">All images used in this educational simulation are in the public domain.</p>
                    <div class="credits-grid">
                        <div class="credit-item"><strong>Fort Sumter:</strong><br>Library of Congress, Public Domain</div>
                        <div class="credit-item"><strong>Battle of Bull Run:</strong><br>Library of Congress, Public Domain</div>
                        <div class="credit-item"><strong>Battle of Shiloh:</strong><br>Library of Congress, Public Domain</div>
                        <div class="credit-item"><strong>Battle of Antietam:</strong><br>National Archives, Public Domain</div>
                        <div class="credit-item"><strong>Battle of Fredericksburg:</strong><br>Library of Congress, Public Domain</div>
                        <div class="credit-item"><strong>Battle of Chancellorsville:</strong><br>National Archives, Public Domain</div>
                        <div class="credit-item"><strong>Siege of Vicksburg:</strong><br>Library of Congress, Public Domain</div>
                        <div class="credit-item"><strong>Battle of Gettysburg:</strong><br>Library of Congress, Public Domain</div>
                        <div class="credit-item"><strong>Battle of Chickamauga:</strong><br>Library of Congress, Public Domain</div>
                        <div class="credit-item"><strong>Battle of the Wilderness:</strong><br>Library of Congress, Public Domain</div>
                        <div class="credit-item"><strong>Battle of Atlanta:</strong><br>Library of Congress, Public Domain</div>
                        <div class="credit-item"><strong>Sherman's March:</strong><br>Library of Congress, Public Domain</div>
                        <div class="credit-item"><strong>Surrender at Appomattox:</strong><br>National Archives, Public Domain</div>
                    </div>
                </div>
            </div>

            <div class="end-actions">
                <button class="btn-primary" id="playAgainBtn">Play Again</button>
                <button class="btn-secondary" id="backToMenuBtn">Back to Menu</button>
            </div>
        </div>

    </main>

    <!-- JavaScript - Data files first, then logic, then UI, then app init -->
    <script src="js/data/battles.js"></script>
    <script src="js/data/leaders.js"></script>
    <script src="js/data/maps.js"></script>
    <script src="js/game.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>

    <!-- Version Display -->
    <div class="version-info">
        <span>Civil War Battle Simulation v3.2.0</span>
    </div>
</body>
</html>
